<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kesihatan Pergigian Sekolah</title>

  <!-- Prevent favicon 404 -->
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=9">

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- SVG sprite -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-time" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/>
    </symbol>
    <symbol id="i-refresh" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12a9 9 0 1 1-3-6.7"/><path d="M21 3v6h-6"/>
    </symbol>
    <symbol id="i-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M4 9V4h5M4 4l6 6"/><path d="M20 15v5h-5M20 20l-6-6"/>
      <path d="M15 4h5v5M20 4l-6 6"/><path d="M9 20H4v-5M4 20l6-6"/>
    </symbol>
    <symbol id="i-filter" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 5h18l-7 8v6l-4-2v-4L3 5z"/>
    </symbol>
    <symbol id="i-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M18 6L6 18M6 6l12 12"/>
    </symbol>
    <symbol id="i-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 18l-6-6 6-6"/><path d="M21 12H9"/>
    </symbol>
    <symbol id="i-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="7"></circle><path d="M21 21l-3.6-3.6"></path>
    </symbol>
    <symbol id="i-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20 6L9 17l-5-5"/>
    </symbol>
    <symbol id="i-eraser" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M16 3l5 5-10 10H6L1 13l10-10 5 5"/>
    </symbol>
  </svg>
</head>
<body>

  <!-- PAGE HEADER -->
  <header class="ph">
    <h1>Kesihatan Pergigian Sekolah</h1>
    <p>Analisis proses dan sasaran kesihatan pergigian pelajar sekolah negeri Kedah.</p>

    <div class="searchbar" role="search">
      <a class="btn btn-ghost" href="index.html" aria-label="Kembali ke halaman utama">
        <svg class="ico" width="20" height="20"><use href="#i-back"/></svg>
      </a>
      <input id="schoolSearch" type="search" placeholder="Cari di halaman ini… (kategori, tajuk graf)" autocomplete="off" />
      <div id="gs-suggest" class="gs-suggest" hidden></div>
      <button id="schoolSearchRight" type="button" class="btn" aria-label="Cari">
        <svg class="ico" width="20" height="20"><use href="#i-search"/></svg>
        <span class="lbl" hidden>Cari</span>
      </button>
    </div>
  </header>

  <main class="grid">

    <!-- Tile 1 -->
    <section class="tile wide" id="ps1tile">
      <div class="th">
        <div>
          <h2 class="ttl">Pra Sekolah, Tadika & Tadika Swasta</h2>
          <div class="sub"><svg class="ico"><use href="#i-time"/></svg><span id="ps1time">—</span></div>
        </div>
        <div class="act">
          <div class="dd">
            <button class="btn dd-trigger" id="ps1filter" title="Tapis">
              <svg class="ico"><use href="#i-filter"/></svg>
            </button>
            <div class="menu" id="ps1menu" hidden style="min-width:320px">
              <div class="menu-body">
                <ul class="cklist" id="ps1list" style="padding:8px 12px 0 12px"></ul>
              </div>
              <div class="mfoot">
                <button class="icbtn" id="ps1all"   title="Pilih Semua"><svg class="ico"><use href="#i-check"/></svg></button>
                <button class="icbtn" id="ps1none"  title="Kosongkan"><svg class="ico"><use href="#i-eraser"/></svg></button>
                <button class="icbtn" id="ps1close" title="Tutup"><svg class="ico"><use href="#i-x"/></svg></button>
              </div>
            </div>
          </div>
          <button id="ps1refresh" class="btn" title="Kemas Kini"><svg class="ico"><use href="#i-refresh"/></svg></button>
          <button id="ps1expand" class="btn" title="Perbesar"><svg class="ico"><use href="#i-expand"/></svg></button>
        </div>
      </div>
      <div class="tb">
        <div class="chart"><canvas id="ps1"></canvas></div>
        <div class="legend" id="ps1legend"></div>
        <div class="err" id="ps1err"></div>
      </div>
    </section>

    <!-- Tile 2 -->
    <section class="tile" id="ps2tile">
      <div class="th">
        <div>
          <h2 class="ttl">Sekolah Rendah</h2>
          <div class="sub"><svg class="ico"><use href="#i-time"/></svg><span id="ps2time">—</span></div>
        </div>
        <div class="act">
          <div class="dd">
            <button class="btn dd-trigger" id="ps2filter" title="Tapis">
              <svg class="ico"><use href="#i-filter"/></svg>
            </button>
            <div class="menu" id="ps2menu" hidden style="min-width:320px">
              <div class="menu-body">
                <ul class="cklist" id="ps2list" style="padding:8px 12px 0 12px"></ul>
              </div>
              <div class="mfoot">
                <button class="icbtn" id="ps2all"   title="Pilih Semua"><svg class="ico"><use href="#i-check"/></svg></button>
                <button class="icbtn" id="ps2none"  title="Kosongkan"><svg class="ico"><use href="#i-eraser"/></svg></button>
                <button class="icbtn" id="ps2close" title="Tutup"><svg class="ico"><use href="#i-x"/></svg></button>
              </div>
            </div>
          </div>
          <button id="ps2refresh" class="btn" title="Kemas Kini"><svg class="ico"><use href="#i-refresh"/></svg></button>
          <button id="ps2expand" class="btn" title="Perbesar"><svg class="ico"><use href="#i-expand"/></svg></button>
        </div>
      </div>
      <div class="tb">
        <div class="chart"><canvas id="ps2"></canvas></div>
        <div class="legend" id="ps2legend"></div>
        <div class="err" id="ps2err"></div>
      </div>
    </section>

    <!-- Tile 3 placeholder -->
    <section class="tile" id="ps3tile">
      <div class="th">
        <div>
          <h2 class="ttl">Intervensi Sekolah</h2>
          <div class="sub"><svg class="ico"><use href="#i-time"/></svg><span>—</span></div>
        </div>
        <div class="act">
          <button class="btn" title="Kemas Kini"><svg class="ico"><use href="#i-refresh"/></svg></button>
          <button class="btn" title="Perbesar"><svg class="ico"><use href="#i-expand"/></svg></button>
        </div>
      </div>
      <div class="tb">
        <div class="chart" style="min-height:340px;display:grid;place-items:center;color:#9aa3af">—</div>
      </div>
    </section>

  </main>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-inner">
      <div class="mh">
        <h3 id="mtitle" style="margin:0;font-weight:800">Perincian</h3>
        <button class="close" id="mclose">Tutup</button>
      </div>
      <div class="mb"><div class="mchart"><canvas id="mcanvas"></canvas></div></div>
    </div>
  </div>

  <footer class="wrap">
    <div class="content">© Kedah Oral Health Analytics • Data Kesihatan Pergigian yang disahkan dan dikemas kini.</div>
  </footer>

<script>
/* ===================== helpers ===================== */
const LABELS_DO = ['Kota Setar','Pendang','Kuala Muda','Sik','Kulim','Bandar Baru','Kubang Pasu','Pdg Terap','Baling','Yan','Langkawi','Kedah'];
const COLS_DO   = ['D','E','F','G','H','I','J','K','L','M','N','O'];
const colIdx = L => L.toUpperCase().charCodeAt(0)-65;
const num = v => { if(v==null) return 0; const n=parseFloat(String(v).replace(/[, ]/g,'')); return isNaN(n)?0:n; };
const nowMY = ()=> new Date().toLocaleString('ms-MY',{hour12:false});
const xTicksRotate = () => ({ autoSkip:false, maxRotation:(window.innerWidth<640?90:0), minRotation:(window.innerWidth<640?90:0) });

function openMenu(btn, menu){
  menu.hidden=false;
  const close = (ev)=>{
    if (!menu.contains(ev.target) && !btn.contains(ev.target)) {
      menu.hidden=true; document.removeEventListener('click', close);
    }
  };
  setTimeout(()=>document.addEventListener('click', close),0);
}

/* ===================== TILE 1 ===================== */
const PS1_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=1190173258&single=true&output=csv';

// Metric list (single-choice)
const PS1_METRICS = [
  { key:'lipTadika', label:'% Liputan Tadika', rows:{ pra:14, ker:17, swa:20 }, axis:'y' },
  { key:'lipMurid',  label:'% Liputan Murid',  rows:{ pra:24, ker:27, swa:30 }, axis:'y' },
  { key:'tpr',       label:'% TPR',            rows:{ pra:34, ker:37, swa:40 }, axis:'y' },
  { key:'mbk',       label:'% MBK',            rows:{ pra:44, ker:47, swa:50 }, axis:'y' },
  { key:'selesai',   label:'% Kes selesai',    rows:{ pra:54, ker:57, swa:61 }, axis:'y' },
  { key:'inst',      label:'Bilangan institusi', rows:{ pra:5, ker:6, swa:7 }, axis:'y2' },
  { key:'enrol',     label:'Enrolmen murid',    rows:{ pra:8, ker:9, swa:10 }, axis:'y2' },
];

const PS1_TARGETS = [
  { label:'Sasaran: % Liputan Tadika — 100%', value:100 },
  { label:'Sasaran: % Liputan Murid — 80%',   value:80  },
  { label:'Sasaran: % TPR — 70%',             value:70  },
  { label:'Sasaran: % Pesakit MBK — 50%',     value:50  },
  { label:'Sasaran: Kes Selesai Pra Sekolah & Tadika Kerajaan — 70%', value:70 },
];

let chartPS1=null;
const ps1State = { metric: PS1_METRICS[0].key, seriesRaw:null };

function buildPS1Filter(){
  const ul = document.getElementById('ps1list');
  PS1_METRICS.forEach((m,i)=>{
    const li = document.createElement('li');
    li.style.listStyle='none'; li.style.padding='6px 6px';
    li.innerHTML = `
      <label style="display:flex;gap:.75rem;align-items:center;cursor:pointer">
        <input type="radio" name="ps1opt" value="${m.key}" ${i===0?'checked':''}>
        <span>${m.label}</span>
      </label>`;
    ul.appendChild(li);
  });
  const btn = document.getElementById('ps1filter');
  const menu= document.getElementById('ps1menu');
  btn.onclick = (e)=>{ e.stopPropagation(); openMenu(btn, menu); };
  document.getElementById('ps1close').onclick = ()=> menu.hidden=true;
  document.getElementById('ps1all').onclick = ()=>{
    ul.querySelectorAll('input[type="radio"]')[0].checked = true;
    ps1State.metric = PS1_METRICS[0].key;
    drawPS1(false);
  };
  document.getElementById('ps1none').onclick = ()=>{
    ul.querySelectorAll('input[type="radio"]').forEach(r=> r.checked=false);
  };
  ul.addEventListener('change',(e)=>{
    if(e.target.name==='ps1opt'){ ps1State.metric = e.target.value; drawPS1(false); }
  });
}
buildPS1Filter();

async function loadPS1(){
  const csv = await (await fetch(PS1_CSV)).text();
  const rows = Papa.parse(csv).data;
  const rowVals=(r)=> COLS_DO.map(c=> num(rows[r-1]?.[colIdx(c)]));

  ps1State.seriesRaw = {
    pra:{
      lipTadika: rowVals(14), lipMurid: rowVals(24), tpr:rowVals(34), mbk:rowVals(44), selesai:rowVals(54),
      inst: rowVals(5), enrol: rowVals(8)
    },
    ker:{
      lipTadika: rowVals(17), lipMurid: rowVals(27), tpr:rowVals(37), mbk:rowVals(47), selesai:rowVals(57),
      inst: rowVals(6), enrol: rowVals(9)
    },
    swa:{
      lipTadika: rowVals(20), lipMurid: rowVals(30), tpr:rowVals(40), mbk:rowVals(50), selesai:rowVals(61),
      inst: rowVals(7), enrol: rowVals(10)
    }
  };
  document.getElementById('ps1time').textContent = nowMY();
}

function ps1Datasets(){
  const c={ pra:{b:'#3b82f6',g:'rgba(59,130,246,.10)'},
            ker:{b:'#22c55e',g:'rgba(34,197,94,.10)'},
            swa:{b:'#a78bfa',g:'rgba(167,139,250,.10)'},
            tgt:'#9ca3af' };
  const m = PS1_METRICS.find(x=>x.key===ps1State.metric);
  const ds = [
    { type:'line', label:'Pra sekolah di sekolah', data:ps1State.seriesRaw.pra[m.key], yAxisID:m.axis, borderColor:c.pra.b, backgroundColor:c.pra.g, tension:.35, fill:true, pointRadius:4, pointHoverRadius:5, borderWidth:2 },
    { type:'line', label:'Tadika kerajaan',        data:ps1State.seriesRaw.ker[m.key], yAxisID:m.axis, borderColor:c.ker.b, backgroundColor:c.ker.g, tension:.35, fill:true, pointRadius:4, pointHoverRadius:5, borderWidth:2 },
    { type:'line', label:'Tadika swasta',          data:ps1State.seriesRaw.swa[m.key], yAxisID:m.axis, borderColor:c.swa.b, backgroundColor:c.swa.g, tension:.35, fill:true, pointRadius:4, pointHoverRadius:5, borderWidth:2 }
  ];
  if(m.axis==='y'){ // add % targets for % metrics
    PS1_TARGETS.forEach(t=>{
      ds.push({ type:'line', label:t.label, data:Array(LABELS_DO.length).fill(t.value), yAxisID:'y',
        borderColor:c.tgt, borderDash:[6,6], borderWidth:2, pointRadius:0, fill:false });
    });
  }
  return ds;
}

function drawPS1(inModal){
  const ctx=(inModal?document.getElementById('mcanvas'):document.getElementById('ps1')).getContext('2d');
  if(!inModal && window.chartPS1) window.chartPS1.destroy();
  if(inModal && window.__mchart) window.__mchart.destroy();
  const m = PS1_METRICS.find(x=>x.key===ps1State.metric);
  const obj=new Chart(ctx,{
    type:'line',
    data:{ labels:LABELS_DO, datasets:ps1Datasets() },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{display:false}, tooltip:{mode:'index',intersect:false,
        callbacks:{ label:(c)=>` ${c.dataset.label}: ${c.dataset.yAxisID==='y'? c.parsed.y.toFixed(0)+'%': c.parsed.y.toLocaleString()} ` } } },
      scales:{
        y:{ beginAtZero:true, max:100, ticks:{callback:v=>v+'%'}, grid:{color:'rgba(156,163,175,.35)',borderDash:[4,4]} },
        y2:{ position:'right', beginAtZero:true, grid:{drawOnChartArea:false}, ticks:{ callback:v=>v.toLocaleString() } },
        x:{ ticks:xTicksRotate() }
      }
    }
  });
  if(inModal) window.__mchart=obj; else window.chartPS1=obj;
}

async function ps1LoadAndDraw(){ try{ await loadPS1(); drawPS1(false); }catch(e){ console.error(e); document.getElementById('ps1err').textContent='Ralat memuat data.'; } }
document.getElementById('ps1refresh').addEventListener('click', ps1LoadAndDraw);
document.getElementById('ps1expand').addEventListener('click', ()=>{
  document.getElementById('mtitle').textContent='Pra Sekolah, Tadika & Tadika Swasta';
  const modal=document.getElementById('modal'); modal.classList.add('open');
  drawPS1(true);
  document.getElementById('mclose').onclick=()=>{ modal.classList.remove('open'); window.__mchart?.destroy(); };
});
ps1LoadAndDraw();

/* ===================== TILE 2 ===================== */
const PS2_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=282265418&single=true&output=csv';

// Metric list (single-choice)
const PS2_METRICS = [
  { key:'sekolah',   label:'Bilangan sekolah', axis:'y2' },
  { key:'enrol',     label:'Jumlah enrolmen',  axis:'y2' },
  { key:'srDilawati',label:'Peratus SR dilawati', axis:'y' },
  { key:'liputan',   label:'Peratus murid SR mendapat liputan', axis:'y' },
  { key:'orallyFit', label:'Peratus murid SR mencapai status orally fit', axis:'y' },
  { key:'kesSelesai',label:'Peratus murid SR kes selesai', axis:'y' },
  { key:'tpr',       label:'Peratus murid SR TPR', axis:'y' }
];

const PS2_TARGETS = [
  { label:'Sasaran: % SR dilawati — 100%', value:100 },
  { label:'Sasaran: % Murid SR mendapat liputan — 96%', value:96 },
  { label:'Sasaran: % Murid SR mencapai status orally fit — 95%', value:95 },
  { label:'Sasaran: % Liputan murid SR mencapai status orally fit kes selesai — 95%', value:95 },
  { label:'Sasaran: % Murid SR maintaining orally fit (TPR) — 65%', value:65 },
];

let chartPS2=null;
const ps2State={ metric: PS2_METRICS[0].key, data:null };

function buildPS2Filter(){
  const ul = document.getElementById('ps2list');
  PS2_METRICS.forEach((m,i)=>{
    const li = document.createElement('li');
    li.style.listStyle='none'; li.style.padding='6px 6px';
    li.innerHTML = `
      <label style="display:flex;gap:.75rem;align-items:center;cursor:pointer">
        <input type="radio" name="ps2opt" value="${m.key}" ${i===0?'checked':''}>
        <span>${m.label}</span>
      </label>`;
    ul.appendChild(li);
  });
  const btn=document.getElementById('ps2filter'); const menu=document.getElementById('ps2menu');
  btn.onclick=(e)=>{ e.stopPropagation(); openMenu(btn, menu); };
  document.getElementById('ps2close').onclick=()=> menu.hidden=true;
  document.getElementById('ps2all').onclick = ()=>{
    ul.querySelectorAll('input[type="radio"]')[0].checked = true;
    ps2State.metric = PS2_METRICS[0].key; drawPS2(false);
  };
  document.getElementById('ps2none').onclick = ()=>{ ul.querySelectorAll('input[type="radio"]').forEach(r=> r.checked=false); };
  ul.addEventListener('change',(e)=>{ if(e.target.name==='ps2opt'){ ps2State.metric=e.target.value; drawPS2(false); } });
}
buildPS2Filter();

async function loadPS2(){
  const csv = await (await fetch(PS2_CSV)).text();
  const rows = Papa.parse(csv).data;
  const rowVals=(r)=> COLS_DO.map(c=> num(rows[r-1]?.[colIdx(c)]));

  ps2State.data = {
    sekolah:{ ker:rowVals(14), swa:rowVals(15), jumlah:rowVals(16) },
    enrol:{ ker:rowVals(17), swa:rowVals(18), jumlah:rowVals(19) },
    srDilawati: rowVals(22),
    liputan:    rowVals(25),
    orallyFit:  rowVals(28),
    kesSelesai: rowVals(31),
    tpr:        rowVals(34)
  };
  document.getElementById('ps2time').textContent = nowMY();
}

function ps2Datasets(){
  const c={ ker:{b:'#3b82f6',g:'rgba(59,130,246,.10)'},
            swa:{b:'#a78bfa',g:'rgba(167,139,250,.10)'},
            jumlah:{b:'#22c55e',g:'rgba(34,197,94,.10)'},
            tgt:'#9ca3af' };
  const m = PS2_METRICS.find(x=>x.key===ps2State.metric);
  const ds=[];
  if(m.key==='sekolah' || m.key==='enrol'){
    const s = ps2State.data[m.key];
    ds.push({type:'line',label:'SR kerajaan',data:s.ker,yAxisID:m.axis,borderColor:c.ker.b,backgroundColor:c.ker.g,tension:.35,fill:true,pointRadius:4,pointHoverRadius:5,borderWidth:2});
    ds.push({type:'line',label:'SR swasta',data:s.swa,yAxisID:m.axis,borderColor:c.swa.b,backgroundColor:c.swa.g,tension:.35,fill:true,pointRadius:4,pointHoverRadius:5,borderWidth:2});
    ds.push({type:'line',label:'Jumlah',data:s.jumlah,yAxisID:m.axis,borderColor:c.jumlah.b,backgroundColor:c.jumlah.g,tension:.35,fill:true,pointRadius:4,pointHoverRadius:5,borderWidth:2});
  } else {
    ds.push({type:'line',label:m.label,data:ps2State.data[m.key],yAxisID:m.axis,borderColor:c.jumlah.b,backgroundColor:c.jumlah.g,tension:.35,fill:true,pointRadius:4,pointHoverRadius:5,borderWidth:2});
    PS2_TARGETS.forEach(t=>{
      // add the matching target depending on metric
      if((m.key==='srDilawati' && t.value===100) ||
         (m.key==='liputan' && t.value===96) ||
         (m.key==='orallyFit' && t.value===95) ||
         (m.key==='kesSelesai' && t.value===95) ||
         (m.key==='tpr' && t.value===65)) {
        ds.push({type:'line',label:t.label,data:Array(LABELS_DO.length).fill(t.value),yAxisID:'y',borderColor:c.tgt,borderDash:[6,6],borderWidth:2,pointRadius:0,fill:false});
      }
    });
  }
  return ds;
}

function drawPS2(inModal){
  const ctx=(inModal?document.getElementById('mcanvas'):document.getElementById('ps2')).getContext('2d');
  if(!inModal && window.chartPS2) window.chartPS2.destroy();
  if(inModal && window.__mchart) window.__mchart.destroy();
  const m=PS2_METRICS.find(x=>x.key===ps2State.metric);
  const obj=new Chart(ctx,{
    type:'line',
    data:{labels:LABELS_DO,datasets:ps2Datasets()},
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{display:false}, tooltip:{mode:'index',intersect:false,callbacks:{label:(c)=>` ${c.dataset.label}: ${c.dataset.yAxisID==='y'? c.parsed.y.toFixed(0)+'%': c.parsed.y.toLocaleString()} `}}},
      scales:{
        y:{beginAtZero:true,max:100,ticks:{callback:v=>v+'%'},grid:{color:'rgba(156,163,175,.35)',borderDash:[4,4]}},
        y2:{position:'right',beginAtZero:true,grid:{drawOnChartArea:false},ticks:{callback:v=>v.toLocaleString()}},
        x:{ticks:xTicksRotate()}
      }
    }
  });
  if(inModal) window.__mchart=obj; else window.chartPS2=obj;
}

async function ps2LoadAndDraw(){ try{ await loadPS2(); drawPS2(false); }catch(e){ console.error(e); document.getElementById('ps2err').textContent='Ralat memuat data.'; } }
document.getElementById('ps2refresh').addEventListener('click', ps2LoadAndDraw);
document.getElementById('ps2expand').addEventListener('click', ()=>{
  document.getElementById('mtitle').textContent='Sekolah Rendah';
  const modal=document.getElementById('modal'); modal.classList.add('open');
  drawPS2(true);
  document.getElementById('mclose').onclick=()=>{ modal.classList.remove('open'); window.__mchart?.destroy(); };
});
ps2LoadAndDraw();

</script>
</body>
</html>
