<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Pergigian Kedah</title>

  <!-- Favicon from assets/icons -->
  <link rel="icon" type="image/svg+xml" href="assets/icons/access.svg" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css?v=1" />

  <style>
    :root{
      --page-max:1200px; --gap:20px; --ctl:44px;
      --ink:#0f172a; --muted:#64748b; --bd:#e5e7eb;
      --panel:#ffffff; --bg:#f7f7fb;
      --accent:#0ea5a0;
      --accent-2:#34d399;
      --shadow-1:0 1px 2px rgba(15,23,42,.06),0 8px 16px rgba(15,23,42,.05);
      /* SHORTER UNIFORM TILE HEIGHT */
      --tile-h: 240px;
    }
    body{ margin:0; background:var(--bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; }

    /* ===== Hero with original gradient background ===== */
    .hero{
      background: linear-gradient(180deg,#0d9488 0%, #10b981 55%, #34d399 100%);
      color:#fff;
      padding: 28px 0 30px;
      box-shadow: inset 0 -1px 0 rgba(255,255,255,.25);
    }
    .hero .wrap{ max-width:var(--page-max); margin:0 auto; padding:0 var(--gap); }
    .hero h1{ margin:0 0 6px; font-size:34px; font-weight:800; letter-spacing:.2px; text-shadow:0 2px 0 rgba(0,0,0,.06); }
    .hero p.sub{ margin:0 0 12px; opacity:.95; font-weight:600; }

    /* Search row in hero (back button removed) */
    .searchbar{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:12px; margin-top:8px; }
    .searchbar input{ height:var(--ctl); border-radius:12px; border:1px solid #d1d5db; padding:0 14px; background:#fff; box-shadow:var(--shadow-1); }
    .searchbar button.search{ height:var(--ctl); width:var(--ctl); border-radius:12px; border:1px solid var(--accent); background:var(--accent); color:#fff; box-shadow:0 4px 14px rgba(14,165,160,.25); cursor:pointer; }

    /* Suggestion dropdown */
    .gs-box{ position:relative; }
    .gs-suggest{ position:absolute; left:0; right:56px; top:calc(var(--ctl) + 8px); background:#fff; border:1px solid var(--bd); border-radius:12px; box-shadow:0 18px 40px rgba(2,6,23,.18); z-index:50; display:none; max-height:320px; overflow:auto; }
    .gs-suggest .opt{ display:flex; flex-direction:column; gap:2px; padding:10px 12px; cursor:pointer; }
    .gs-suggest .opt:hover, .gs-suggest .opt.active{ background:#f7fafc; }
    .gs-suggest .type{ font-size:10px; font-weight:800; color:#0ea5e9; text-transform:uppercase; letter-spacing:.04em; }
    .gs-suggest .lbl{ font-size:14px; color:#0f172a; }
    .gs-suggest .sub{ font-size:12px; color:#64748b; }
    .gs-suggest .empty{ padding:10px 12px; color:#64748b; font-size:13px; }

    /* ===== Tiles layout ===== */
    .tiles{
      max-width:var(--page-max); margin:14px auto 24px; padding:0 var(--gap);
      display:grid; grid-template-columns:repeat(5, minmax(0, 1fr)); gap:14px;
      align-items:stretch; justify-items:stretch;
    }
    @media (max-width:1100px){ .tiles{ grid-template-columns:repeat(3, minmax(0,1fr)); } }
    @media (max-width:720px){ .tiles{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    @media (max-width:420px){ .tiles{ grid-template-columns:1fr; } }

    /* ===== Card look (top bar removed, icon centered & larger) ===== */
    .tile-card{
      position:relative;
      background:var(--panel);
      border:1px solid var(--bd);
      border-radius:16px;
      box-shadow:var(--shadow-1);
      display:flex; flex-direction:column; align-items:center; text-align:center;
      padding:20px 16px 16px;
      text-decoration:none; color:inherit;
      transition: box-shadow .2s ease, transform .2s ease;
      height: var(--tile-h);        /* fixed shorter height for all tiles */
    }
    .tile-card::before{ content:none; } /* top accent removed */

    /* Centered bigger icon */
    .tile-card .icon{
      width:64px; height:64px; display:block;
      filter: brightness(0) saturate(100%) invert(40%) sepia(68%) saturate(545%) hue-rotate(129deg) brightness(92%) contrast(92%);
      margin:6px auto 12px;
    }

    .tile-card .title{ margin:0 0 6px; font-weight:800; font-size:18px; }
    .tile-card .subtitle{ margin:0 0 10px; color:var(--muted); font-size:12px; min-height:30px; }

    .tile-card .cta{
      margin-top:auto;
      display:inline-flex; align-items:center; gap:8px;
      font-weight:700; font-size:13px; color:var(--accent);
      align-self:center;
    }
    .tile-card:hover{ box-shadow:0 8px 28px rgba(2,6,23,.14); transform: translateY(-1px); }

    /* Keep aspect flexible */
    .square{ aspect-ratio:auto; }

    /* ---- footer centered relative to page (not limited by tiles width) ---- */
    footer.wrap{
      width:100%; max-width:100%;
      margin: 8px auto 20px; padding: 0 var(--gap);
      color:#94a3b8; font-size:12px; text-align:center;
    }

    .ico{ width:18px; height:18px; }

    /* ========= NEW: dataviz tile styles (added, non-breaking) ========= */

    /* grid spans for the second row */
    .span-3{ grid-column: span 3; }
    .span-2{ grid-column: span 2; }

    /* dataviz tile and inside box */
    .data-tile{ height:360px; overflow:visible; padding:20px; }
    .data-frame{
      position:relative; width:100%; height:100%;
      background:linear-gradient(180deg,#f9fbff 0%, #f4f7fb 100%);
      border-radius:28px;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.9),
        inset 0 -1px 0 rgba(2,6,23,0.05),
        inset 0 24px 40px rgba(2,6,23,0.05),
        inset 0 -20px 36px rgba(2,6,23,0.04);
      border:1px solid #e9eef6;
    }

    /* bars layout, leaving space at left/right for the 'touching' KPI chips */
    .bars{
      position:absolute; inset:26px 84px 40px 84px;
      display:grid; grid-template-columns:repeat(8,1fr); align-items:end; gap:18px;
      pointer-events:none;
    }
    .bar{ grid-column: span 1; height:100%; display:flex; align-items:flex-end; justify-content:center; position:relative; }
    .bar .track{
      width:22px; height:100%; border-radius:12px;
      background:linear-gradient(180deg,#ffffff 0%, #eef3f9 100%);
      box-shadow: inset 0 0 0 1px #e6ebf2, inset 0 -14px 22px rgba(15,23,42,.06);
      position:relative;
    }
    .bar .fill{
      position:absolute; bottom:0; left:0; right:0; margin:auto; width:22px; border-radius:12px;
      height:0%; background: var(--color, #0ea5a0); box-shadow: 0 8px 16px rgba(2,6,23,.12);
      transition: height 1.1s cubic-bezier(.22,.75,.15,1.0);
    }
    .bar .lbl{
      position:absolute; bottom:-26px; left:50%; transform:translateX(-50%);
      font-size:12px; color:#334155; white-space:nowrap; font-weight:700;
    }
    .bar.b1{ grid-column:2; } .bar.b2{ grid-column:4; } .bar.b3{ grid-column:6; } .bar.b4{ grid-column:8; }

    /* KPI chips that 'kiss' the inside box + colored badge behind each icon */
    .kpi{
      position:absolute; display:flex; align-items:center; gap:12px;
      padding:14px 18px; border-radius:18px; background:#fff;
      border:1px solid #e7ecf3; box-shadow:0 8px 24px rgba(2,6,23,.12);
      text-decoration:none; color:inherit; opacity:0; transform: translateY(6px);
      animation: fadeUp .7s ease forwards; pointer-events:auto;
    }
    .kpi.tl{ top:36px; left:-6px; animation-delay:.12s; }
    .kpi.tr{ top:36px; right:-6px; animation-delay:.22s; }
    .kpi.bl{ bottom:36px; left:-6px; animation-delay:.32s; }
    .kpi.br{ bottom:36px; right:-6px; animation-delay:.42s; }

    .badge{
      width:32px; height:32px; border-radius:10px; background:var(--badge, #94a3b8);
      display:grid; place-items:center; box-shadow:0 6px 14px rgba(2,6,23,.15), inset 0 1px 0 rgba(255,255,255,.9);
    }
    .kpi .mini{ width:18px; height:18px; filter: invert(1) brightness(2); }
    .kpi .vals{ display:flex; flex-direction:column; align-items:flex-start; }
    .kpi .big{ font-weight:800; font-size:20px; line-height:1.15; }
    .kpi .small{ font-size:13px; color:#475569; }

    @keyframes fadeUp{ from{ opacity:0; transform:translateY(8px); } to{ opacity:1; transform:translateY(0);} }
  </style>

  <!-- icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 18l-6-6 6-6"/><path d="M21 12H9"/>
    </symbol>
    <symbol id="i-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/>
    </symbol>
  </svg>
</head>
<body>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap">
      <h1>Dashboard Pergigian Kedah</h1>
      <p class="sub">Sumber: Google Sheets (Publish to Web)</p>

      <div class="gs-box">
        <div class="searchbar">
          <!-- Back button intentionally removed -->
          <input id="globalSearch" type="search" placeholder="Cari halaman, graf atau saringan…" autocomplete="off" />
          <button class="search" id="goBtn" title="Cari">
            <svg class="ico"><use href="#i-search" /></svg>
          </button>
        </div>
        <div class="gs-suggest" id="suggestBox"></div>
      </div>
    </div>
  </section>

  <main class="tiles">
    <!-- Akses -->
    <a class="tile-card square" href="akses.html">
      <img class="icon" src="assets/icons/access.svg" alt="Akses" />
      <h3 class="title">Akses Perkhidmatan Pergigian</h3>
      <p class="subtitle">Status akses perkhidmatan mengikut daerah.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Sekolah -->
    <a class="tile-card square" href="sekolah.html">
      <img class="icon" src="assets/icons/sekolah.svg" alt="Sekolah" />
      <h3 class="title">Kesihatan Pergigian Sekolah</h3>
      <p class="subtitle">Pra sekolah, sekolah rendah dan menengah.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- KPI -->
    <a class="tile-card square" href="kpi.html">
      <img class="icon" src="assets/icons/kpi.svg" alt="KPI" />
      <h3 class="title">Indikator Prestasi Utama (KPI)</h3>
      <p class="subtitle">Sasaran utama kesihatan pergigian.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Tenaga Kerja -->
    <a class="tile-card square" href="workforce.html">
      <img class="icon" src="assets/icons/workforce.svg" alt="Tenaga Kerja" />
      <h3 class="title">Tenaga Kerja Pergigian</h3>
      <p class="subtitle">Latihan & purata hasil kerja.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Program Pencegahan -->
    <a class="tile-card square" href="prevention.html">
      <img class="icon" src="assets/icons/prevention.svg" alt="Pencegahan" />
      <h3 class="title">Program Pencegahan Pergigian</h3>
      <p class="subtitle">MMI, klinikal pencegahan karies & outreach.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- ================= NEW SECOND ROW ================= -->

    <!-- Left: Data Visualization (replicated design) -->
    <div class="tile-card data-tile span-3" id="dv1">
      <div class="data-frame">
        <!-- Bars area -->
        <div class="bars" id="bars">
          <div class="bar b1" style="--color:#F0668F">
            <div class="track"><div class="fill"></div></div>
            <div class="lbl">Akses</div>
          </div>
          <div class="bar b2" style="--color:#FBAC45">
            <div class="track"><div class="fill"></div></div>
            <div class="lbl">% Toddler TPR</div>
          </div>
          <div class="bar b3" style="--color:#42BC9E">
            <div class="track"><div class="fill"></div></div>
            <div class="lbl">Ibu Mengandung OF</div>
          </div>
          <div class="bar b4" style="--color:#59AFE2">
            <div class="track"><div class="fill"></div></div>
            <div class="lbl">Warga Emas ≥20 gigi</div>
          </div>
        </div>

        <!-- KPI chips 'touching' inner box + colored icon badge -->
        <a class="kpi tl" id="kpi1" href="akses.html?tile=1" title="Akses Perkhidmatan Pergigian" style="--badge:#F0668F">
          <span class="badge"><img class="mini" src="assets/icons/aksesPendudukKedah.svg" alt="Akses icon" /></span>
          <div class="vals">
            <div class="big" data-val="1">--%</div>
            <div class="small"><span data-ten="1">-</span> daripada 10 orang</div>
          </div>
        </a>

        <a class="kpi tr" id="kpi2" href="akses.html?tile=5&filter=maintaining_orally_fit" title="% Toddler TPR" style="--badge:#FBAC45">
          <span class="badge"><img class="mini" src="assets/icons/babyToddler.svg" alt="Toddler icon" /></span>
          <div class="vals">
            <div class="big" data-val="2">--%</div>
            <div class="small"><span data-ten="2">-</span> daripada 10 toddler</div>
          </div>
        </a>

        <a class="kpi br" id="kpi3" href="akses.html?tile=6&filter=ibu_orally_fit" title="% Ibu Mengandung Orally Fit" style="--badge:#42BC9E">
          <span class="badge"><img class="mini" src="assets/icons/pregnantWoman.svg" alt="Ibu Mengandung icon" /></span>
          <div class="vals">
            <div class="big" data-val="3">--%</div>
            <div class="small"><span data-ten="3">-</span> daripada 10 Ibu Mengandung</div>
          </div>
        </a>

        <a class="kpi bl" id="kpi4" href="akses.html?tile=9&filter=wargaemas_gigi20" title="% Warga Emas ≥20 gigi" style="--badge:#59AFE2">
          <span class="badge"><img class="mini" src="assets/icons/wargaEmas.svg" alt="Warga Emas icon" /></span>
          <div class="vals">
            <div class="big" data-val="4">--%</div>
            <div class="small"><span data-ten="4">-</span> daripada 10 Warga Emas</div>
          </div>
        </a>
      </div>
    </div>

    <!-- Right: Empty placeholder -->
    <div class="tile-card span-2" id="dv2">
      <img class="icon" src="assets/icons/kpi.svg" alt="Kosong" />
      <h3 class="title">Data Visualization</h3>
      <p class="subtitle">Kosong — akan diisi kemudian.</p>
    </div>
  </main>

  <footer class="wrap">Analisa Kesihatan Pergigian Negeri Kedah • Paparan optimum disyorkan melalui pelayar web desktop</footer>

  <script>
    // ---------- SEARCH MANIFEST ----------
    function link(page, tile, key){
      const u = new URL(page, location.href);
      if (tile)   u.searchParams.set('tile', tile);
      if (key)    u.searchParams.set('filter', key);
      return u.pathname.replace(location.pathname.split('/').pop(),'') + u.search;
    }

    const AKSES = [
      { type:'tile', page:'akses.html', tile:'', key:'', label:'Akses Perkhidmatan Pergigian', sub:'Halaman' },
    ];

    const SEKOLAH = [
      { type:'tile', page:'sekolah.html', tile:'ps1-tile', key:'', label:'Pra Sekolah, Tadika & Tadika Swasta', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m1', label:'Bilangan institusi', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m2', label:'Jumlah enrolmen', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m3', label:'% Liputan Tadika', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m4', label:'% Liputan Murid', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m5', label:'% TPR', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m6', label:'% MBK', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m7', label:'% Kes selesai', sub:'Pra Sekolah' },

      { type:'tile', page:'sekolah.html', tile:'sr2-tile', key:'', label:'Sekolah Rendah', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_bil', label:'Bilangan sekolah', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_enrol', label:'Jumlah enrolmen', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_dilawati', label:'Peratus SR dilawati', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_liputan', label:'Peratus murid SR mendapat liputan', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_orallyfit', label:'Peratus murid SR mencapai status orally fit', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_kesselesai', label:'Peratus murid SR kes selesai', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_tpr', label:'Peratus murid SR TPR', sub:'Sekolah Rendah' },

      { type:'tile', page:'sekolah.html', tile:'sm3-tile', key:'', label:'Sekolah Menengah', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_bil', label:'Bilangan sekolah (SM)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_enrol', label:'Jumlah enrolmen (SM)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_dilawati', label:'Peratus SM dilawati', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_liputan', label:'Peratus murid SM mendapat liputan', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_orallyfit', label:'Peratus murid SM mencapai status orally fit', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_kesselesai', label:'Peratus liputan murid SM mencapai status orally fit (kes selesai)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_tpr', label:'Peratus murid SM TPR', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_kehilangan', label:'Kehilangan gigi kekal/100 murid 16 tahun', sub:'Sekolah Menengah' },
    ];

    const KPI = [
      { type:'tile', page:'kpi.html', tile:'k1-tile', key:'', label:'KEY ORAL HEALTH GOALS', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf6', label:'6-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf12', label:'12-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf16', label:'16-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'hp12', label:'12-year-olds with healthy periodontium', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'hp16', label:'16-year-olds with healthy periodontium', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'ft20', label:'60-year-old and above with minimum 20 functional teeth', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'oc_stage1', label:'Oral cancers detected at stage 1', sub:'Key Goals' },

      { type:'tile', page:'kpi.html', tile:'k2-tile', key:'', label:'NIA', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_primary_tpr',   label:'Percentage of Primary School Children Maintaining Orally Fit Status', sub:'NIA' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_secondary_tpr', label:'Percentage of Secondary School Children Maintaining Orally Fit Status', sub:'NIA' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_under5_cariesfree', label:'Percentage of Children below 5 years examined with Caries Free Mouth', sub:'NIA' },

      { type:'tile', page:'kpi.html', tile:'k3-tile', key:'', label:'SUPPORTING ORAL HEALTH GOALS', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dfx6',   label:'6-year-olds - mean dfx', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dmfx12', label:'12-year-olds - mean DMFX', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dmfx16', label:'16-year-olds - mean DMFX', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'m16',    label:'16-year-olds - mean M', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'m0_16',  label:'16-year-olds with M = 0', sub:'Supporting Goals' },
    ];

    const WORKFORCE = [
      { type:'tile', page:'workforce.html', tile:'tkp1-tile', key:'', label:'Latihan Dalam Perkhidmatan', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c1', label:'% of courses/training conduct using LDP allocation', sub:'LDP' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c2', label:'% of LDP allocation spend', sub:'LDP' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c3', label:'% of staffs with 3 days in-service training', sub:'Latihan' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c4', label:'% of staffs with 7 days in-service training', sub:'Latihan' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c5', label:'% of MyCPD users with 0 MyCPD point', sub:'MyCPD' },

      { type:'tile', page:'workforce.html', tile:'tkp2-tile', key:'', label:'PURATA HASIL KERJA Pegawai Pergigian', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pp_on_duty',    label:'Bil. PP yang bertugas', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pasien_total',  label:'Pesakit Baru + Ulangan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pasien_rate',   label:'Pesakit Baru + Ulangan (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'tampalan_total', label:'Tampalan Gigi Kekal + Desidus (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'tampalan_rate',  label:'Tampalan Gigi Kekal + Desidus (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'cabut_total',   label:'Cabutan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'cabut_rate',    label:'Cabutan (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'skaler_total',  label:'Penskaleran (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'skaler_rate',   label:'Penskaleran (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'dentur_total',  label:'Dentur (penuh+separa) (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'dentur_rate',   label:'Dentur (penuh+separa) (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'fisur_total',   label:'Fisur Sealan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'fisur_rate',    label:'Fisur Sealan (Purata)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'varnis_total',  label:'Florida varnis (Jumlah)', sub:'Pegawai' },

      { type:'tile', page:'workforce.html', tile:'tkp3-tile', key:'', label:'PURATA HASIL KERJA Juruterapi Pergigian', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_on_duty',      label:'Bil. JP yang bertugas', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_pasien_total', label:'Pesakit Baru + Ulangan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_pasien_rate',  label:'Pesakit Baru + Ulangan (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_tampalan_total', label:'Tampalan Gigi Kekal + Desidus (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_tampalan_rate',  label:'Tampalan Gigi Kekal + Desidus (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_cabut_total',   label:'Cabutan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_cabut_rate',    label:'Cabutan (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_skal_total',    label:'Penskaleran (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_skal_rate',     label:'Penskaleran (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_fisur_total',   label:'Fisur Sealan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_fisur_rate',    label:'Fisur Sealan (Purata)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_varnis_total',  label:'Florida varnis (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_varnis_rate',   label:'Florida varnis (Purata)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_kes_total',     label:'Kes selesai (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_kes_rate',      label:'Kes selesai (Purata/JP)', sub:'Juruterapi' },
    ];

    const PREVENTION = [
      { type:'tile', page:'prevention.html', tile:'p1-tile', key:'', label:'Clinical Prevention Program for Caries', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj23', label:'Cohort Jan-Jun 2023', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd23', label:'Cohort Jul-Dis 2023', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj24', label:'Cohort Jan-Jun 2024', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd24', label:'Cohort Jul-Dis 2024', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj25', label:'Cohort Jan-Jun 2025', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd25', label:'Cohort Jul-Dis 2025', sub:'Clinical Prevention' },

      { type:'filter', page:'prevention.html', tile:'p1', key:'paa_mbk',                 label:'Program Anak Angkat — % anak angkat dengan status MBK', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fv_pre',                  label:'% of pre-schoolchildren rendered FV', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fv_primary',              label:'% of primary schoolchildren rendered FV', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_pre',                  label:'% of pre-schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_preschool',      label:'% of teeth rendered FS (Preschool)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_primary',              label:'% of primary schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_primary',        label:'% of teeth rendered FS (Primary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_secondary',            label:'% of secondary schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_secondary',      label:'% of teeth rendered FS (Secondary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_primary',             label:'% of primary schoolchildren rendered PRR', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_teeth_primary',       label:'% of teeth rendered PRR (Primary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_secondary',           label:'% of secondary schoolchildren rendered PRR', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_teeth_secondary',     label:'% of teeth rendered PRR (Secondary school)', sub:'Clinical Prevention' },

      { type:'tile', page:'prevention.html', tile:'p2-tile', key:'', label:'Malaysian Modified ICDAS', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_schools',     label:'primary schools screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_children',    label:'primary school children screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_E',           label:'primary schoolchildren with E', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_meanD',       label:'Mean D of primary schoolchildren', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_schools',   label:'secondary schools screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_children',  label:'secondary school children screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_E',         label:'secondary schoolchildren with E', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_meanD',     label:'Mean D of secondary schoolchildren', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_staff_trained',       label:'staff trained with MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_calibration_sessions',label:'No of calibration session conducted', sub:'MMI' },

      { type:'tile', page:'prevention.html', tile:'p3-tile', key:'', label:'Outreach', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'new_patient',             label:"new patient at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'repeat_patient',          label:"repeat patient at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'attendance',              label:"patients' attendance at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'kg_angkat_screening',     label:"% Kg. Angkat visited with oral cancer screening", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2021',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2021", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2022',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2022", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2023',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2023", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2024',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2024", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2025',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2025", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'bilangan_selesai_baharu', label:"% Bilangan selesai kes / kehadiran baharu", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'ppr_homevisit',           label:"% of homevisit done to the family in PPR", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'ppr_kes_selesai',         label:"% Kes Selesai in PPR", sub:'Outreach' },
    ];

    const SEARCH_INDEX = [
      ...AKSES, ...SEKOLAH.filter(x=>x.type==='tile'), ...KPI.filter(x=>x.type==='tile'),
      ...WORKFORCE.filter(x=>x.type==='tile'), ...PREVENTION.filter(x=>x.type==='tile'),
      ...SEKOLAH.filter(x=>x.type==='filter'), ...KPI.filter(x=>x.type==='filter'),
      ...WORKFORCE.filter(x=>x.type==='filter'), ...PREVENTION.filter(x=>x.type==='filter'),
    ].map(item => ({ ...item, url: link(item.page, item.tile, item.key) }));

    // ---------- AUTOCOMPLETE ----------
    const q = document.getElementById('globalSearch');
    const box = document.getElementById('suggestBox');
    const goBtn = document.getElementById('goBtn');

    function normalize(s){ return (s||'').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,''); }

    function search(term){
      const t = normalize(term).trim();
      if(!t) return [];
      const parts = t.split(/\s+/).filter(Boolean);
      return SEARCH_INDEX.filter(item=>{
        const hay = normalize(item.label + ' ' + (item.sub||''));
        return parts.every(p => hay.includes(p));
      }).slice(0, 50);
    }

    function render(list){
      if(!list.length){
        box.innerHTML = '<div class="empty">Tiada cadangan.</div>';
        box.style.display = 'block';
        return;
      }
      box.innerHTML = list.map((it,i)=>`
        <div class="opt" data-url="${it.url}">
          <span class="type">${it.type === 'filter' ? 'Saringan' : 'Graf'}</span>
          <span class="lbl">${it.label}</span>
          <span class="sub">${it.sub || ''}</span>
        </div>
      `).join('');
      box.style.display = 'block';
    }

    let current=-1, currentList=[];
    q.addEventListener('input', () => { current=-1; currentList = search(q.value); render(currentList); });
    q.addEventListener('focus', () => { if(q.value) { currentList = search(q.value); render(currentList); } });

    box.addEventListener('mousedown', (e)=>{
      const opt = e.target.closest('.opt'); if(!opt) return;
      location.href = opt.getAttribute('data-url');
    });

    q.addEventListener('keydown', (e)=>{
      if(box.style.display!=='block') return;
      const opts = [...box.querySelectorAll('.opt')];
      if(e.key==='ArrowDown'){ e.preventDefault(); current = (current+1) % opts.length; opts.forEach(o=>o.classList.remove('active')); opts[current].classList.add('active'); opts[current].scrollIntoView({block:'nearest'}); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); current = (current-1+opts.length) % opts.length; opts.forEach(o=>o.classList.remove('active')); opts[current].classList.add('active'); opts[current].scrollIntoView({block:'nearest'}); }
      else if(e.key==='Enter'){ e.preventDefault(); if(current>=0){ location.href = opts[current].getAttribute('data-url'); } else if(currentList[0]) { location.href = currentList[0].url; } }
      else if(e.key==='Escape'){ box.style.display='none'; }
    });

    document.addEventListener('click', (e)=>{ if(!document.querySelector('.gs-box').contains(e.target)) box.style.display='none'; });
    goBtn.addEventListener('click', ()=>{ const list = search(q.value); if(list[0]) location.href = list[0].url; });
  </script>

  <!-- ======== NEW: dataviz fetch + animation (appended; does not alter existing code) ======== -->
  <script>
    // Four series mapping as requested
    const DV_SERIES = [
      {
        color:'#F0668F',
        url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=1057141723&single=true&output=csv',
        cell:'N11',
        valueElQ:'[data-val="1"]',
        tenElQ:'[data-ten="1"]'
      },
      {
        color:'#FBAC45',
        url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=1851801564&single=true&output=csv',
        cell:'O28',
        valueElQ:'[data-val="2"]',
        tenElQ:'[data-ten="2"]'
      },
      {
        color:'#42BC9E',
        url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=205423549&single=true&output=csv',
        cell:'O19',
        valueElQ:'[data-val="3"]',
        tenElQ:'[data-ten="3"]'
      },
      {
        color:'#59AFE2',
        url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=480846724&single=true&output=csv',
        cell:'O39',
        valueElQ:'[data-val="4"]',
        tenElQ:'[data-ten="4"]'
      }
    ];

    // helpers to read single cell from "publish to web" CSV
    function colToIndex(col){ let n=0; for(let i=0;i<col.length;i++){ n = n*26 + (col.charCodeAt(i)-64);} return n-1; }
    function parseCellRef(ref){ const m = ref.match(/^([A-Z]+)(\d+)$/i); return { c: colToIndex(m[1].toUpperCase()), r: parseInt(m[2],10)-1 }; }
    function simpleCSVParse(txt){
      const rows=[]; let row=[],cur='',inQ=false;
      for(let i=0;i<txt.length;i++){ const ch=txt[i],nx=txt[i+1];
        if(ch=='"'){ if(inQ && nx=='"'){cur+='"'; i++;} else inQ=!inQ; }
        else if(ch==',' && !inQ){ row.push(cur); cur=''; }
        else if((ch=='\n'||ch=='\r') && !inQ){ if(cur!==''||row.length){ row.push(cur); rows.push(row); row=[]; cur=''; } if(ch=='\r'&&nx=='\n'){ i++; } }
        else cur+=ch;
      }
      if(cur!==''||row.length){ row.push(cur); rows.push(row); }
      return rows;
    }
    async function fetchCell(url, cellRef){
      try{
        const res = await fetch(url, {cache:'no-store'});
        const txt = await res.text();
        const data = simpleCSVParse(txt);
        const {r,c} = parseCellRef(cellRef);
        let raw = (data[r] && data[r][c]) || '';
        raw = (''+raw).replace('%','').trim();
        const num = parseFloat(raw);
        return isNaN(num)? null : num;
      }catch(err){
        console.error('CSV fetch error', err);
        return null;
      }
    }
    function fmtPct(v){ return (v!=null && isFinite(v)) ? (Math.round(v*10)/10).toFixed(1).replace(/\.0$/,'') + '%' : '--%'; }
    function perTen(v){ if(v==null || !isFinite(v)) return '-'; const x=v/10; const dec=(Math.abs(x-Math.round(x))<1e-6)?0:1; return x.toFixed(dec); }

    async function loadViz(){
      const bars = document.querySelectorAll('#bars .bar');
      if(!bars.length) return;
      await Promise.all(DV_SERIES.map(async (s,i)=>{
        const v = await fetchCell(s.url, s.cell);
        // numbers
        const ve = document.querySelector(s.valueElQ);
        const te = document.querySelector(s.tenElQ);
        if(ve) ve.textContent = fmtPct(v);
        if(te) te.textContent = perTen(v);
        // bars
        const fill = bars[i]?.querySelector('.fill');
        if(fill) setTimeout(()=>{ fill.style.height = (v? v:0) + '%'; }, 120 + i*140);
      }));
    }
    if(document.readyState !== 'loading') loadViz();
    else document.addEventListener('DOMContentLoaded', loadViz);
  </script>
</body>
</html>
