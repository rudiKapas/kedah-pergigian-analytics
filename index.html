<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Pergigian Kedah</title>

  <!-- Favicon from assets/icons -->
  <link rel="icon" type="image/svg+xml" href="assets/icons/access.svg" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css?v=1" />

  <style>
    :root{
      --page-max:1200px; --gap:20px; --ctl:44px;
      --ink:#0f172a; --muted:#64748b; --bd:#e5e7eb;
      --panel:#ffffff; --bg:#f7f7fb;
      --accent:#0ea5a0;
      --accent-2:#34d399;
      --shadow-1:0 1px 2px rgba(15,23,42,.06),0 8px 16px rgba(15,23,42,.05);
      --tile-h: 240px;
      --neu-surface: var(--panel);          /* <<< frame color = tile color */
      --neu-dark: rgba(15,23,42,.12);
      --neu-light: rgba(255,255,255,.90);
    }
    body{ margin:0; background:var(--bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; }

  /* Title for the dataviz tile (sits above the inner frame) */
  .dv-title{
    position:absolute;
    top:16px;
    left:28px;
    right:28px;
    text-align:center;
    font-weight:600;
    font-size:16px;
    line-height:1.25;
    color:var(--muted);
    text-wrap:balance;
    pointer-events:none;  /* no interference with chip clicks */
  }
  @media (max-width:1100px){ .dv-title{ font-size:15px; } }
  @media (max-width:720px){  .dv-title{ font-size:14px; } }

    
  /* ===== Hero with original gradient background ===== */
  .hero{
    background: linear-gradient(180deg,#0d9488 0%, #10b981 55%, #34d399 100%);
    color:#fff;
    padding: 28px 0 30px;
    box-shadow: inset 0 -1px 0 rgba(255,255,255,.25);
  }
    }
    .hero .wrap{ max-width:var(--page-max); margin:0 auto; padding:0 var(--gap); }
    .hero h1{ margin:0 0 6px; font-size:34px; font-weight:800; letter-spacing:.2px; text-shadow:0 2px 0 rgba(0,0,0,.06); }
    .hero p.sub{ margin:0 0 12px; opacity:.95; font-weight:600; }

    /* Search row in hero (back button removed) */
    .searchbar{ display:grid; grid-template-columns:1fr auto; align-items:center; gap:12px; margin-top:8px; }
    .searchbar input{ height:var(--ctl); border-radius:12px; border:1px solid #d1d5db; padding:0 14px; background:#fff; box-shadow:var(--shadow-1); }
    .searchbar button.search{ height:var(--ctl); width:var(--ctl); border-radius:12px; border:1px solid var(--accent); background:var(--accent); color:#fff; box-shadow:0 4px 14px rgba(14,165,160,.25); cursor:pointer; }

    /* Suggestion dropdown */
    .gs-box{ position:relative; }
    .gs-suggest{ position:absolute; left:0; right:56px; top:calc(var(--ctl) + 8px); background:#fff; border:1px solid var(--bd); border-radius:12px; box-shadow:0 18px 40px rgba(2,6,23,.18); z-index:50; display:none; max-height:320px; overflow:auto; }
    .gs-suggest .opt{ display:flex; flex-direction:column; gap:2px; padding:10px 12px; cursor:pointer; }
    .gs-suggest .opt:hover, .gs-suggest .opt.active{ background:#f7fafc; }
    .gs-suggest .type{ font-size:10px; font-weight:800; color:#0ea5e9; text-transform:uppercase; letter-spacing:.04em; }
    .gs-suggest .lbl{ font-size:14px; color:#0f172a; }
    .gs-suggest .sub{ font-size:12px; color:#64748b; }
    .gs-suggest .empty{ padding:10px 12px; color:#64748b; font-size:13px; }

    /* ===== Tiles layout ===== */
    .tiles{
      max-width:var(--page-max); margin:14px auto 24px; padding:0 var(--gap);
      display:grid; grid-template-columns:repeat(5, minmax(0, 1fr)); gap:14px;
      align-items:stretch; justify-items:stretch;
    }
    @media (max-width:1100px){ .tiles{ grid-template-columns:repeat(3, minmax(0,1fr)); } }
    @media (max-width:720px){ .tiles{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    @media (max-width:420px){ .tiles{ grid-template-columns:1fr; } }

    /* Full-width row heading inside the tiles grid */
    .tiles .row-heading{
      grid-column: 1 / -1;     /* span all columns so it sits on its own row */
      font-weight: 800;
      font-size: 26px;         /* header is 34px – this is a bit smaller */
      line-height: 1.2;
      color: var(--ink);
      text-align: left;
      margin: 6px 0 2px;       /* reasonable breathing room above/below */
    }
    @media (max-width:1100px){ .tiles .row-heading{ font-size:24px; } }
    @media (max-width:720px){  .tiles .row-heading{ font-size:20px; } }

    #summaryHeading {
      font-weight: 600;         /* half-bold */
      color: var(--muted);      /* == #64748b */
    }


    /* ===== Card look (top bar removed, icon centered & larger) ===== */
    .tile-card{
      position:relative;
      background:var(--panel);
      border:1px solid var(--bd);
      border-radius:16px;
      box-shadow:var(--shadow-1);
      display:flex; flex-direction:column; align-items:center; text-align:center;
      padding:20px 16px 16px;
      text-decoration:none; color:inherit;
      transition: box-shadow .2s ease, transform .2s ease;
      height: var(--tile-h);
    }
    .tile-card::before{ content:none; } /* top accent removed */

    /* Centered bigger icon */
    .tile-card .icon{
      width:64px; height:64px; display:block;
      filter: brightness(0) saturate(100%) invert(40%) sepia(68%) saturate(545%) hue-rotate(129deg) brightness(92%) contrast(92%);
      margin:6px auto 12px;
    }

    .tile-card .title{ margin:0 0 6px; font-weight:800; font-size:18px; }
    .tile-card .subtitle{ margin:0 0 10px; color:var(--muted); font-size:12px; min-height:30px; }

    .tile-card .cta{
      margin-top:auto;
      display:inline-flex; align-items:center; gap:8px;
      font-weight:700; font-size:13px; color:var(--accent);
      align-self:center;
    }

    /* Row-1 only: hide 'info lanjut' by matching tile background; show green on hover */
    .tiles > a.tile-card:nth-of-type(-n+5) .cta{
      color: var(--panel);          /* same as tile background (#fff) */
    }
    .tiles > a.tile-card:nth-of-type(-n+5):hover .cta{
      color: var(--accent);         /* keep the same green on hover */
    }

    .tile-card:hover{ box-shadow:0 8px 28px rgba(2,6,23,.14); transform: translateY(-1px); }

    /* Keep aspect flexible */
    .square{ aspect-ratio:auto; }

    /* ---- footer centered to full page ---- */
    footer.wrap{ width:100%; max-width:100%; margin: 8px auto 20px; padding: 0 var(--gap); color:#94a3b8; font-size:12px; text-align:center; }

    .ico{ width:18px; height:18px; }
  </style>

  <!-- icons -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="i-back" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M15 18l-6-6 6-6"/><path d="M21 12H9"/>
    </symbol>
    <symbol id="i-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/>
    </symbol>
  </svg>
</head>
<body>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap">
      <h1>Dashboard Pergigian Kedah</h1>
      <p class="sub">Sumber: Google Sheets (Data Teknikal)</p>

      <div class="gs-box">
        <div class="searchbar">
          <!-- Back button intentionally removed -->
          <input id="globalSearch" type="search" placeholder="Cari halaman, graf atau saringan…" autocomplete="off" />
          <button class="search" id="goBtn" title="Cari">
            <svg class="ico"><use href="#i-search" /></svg>
          </button>
        </div>
        <div class="gs-suggest" id="suggestBox"></div>
      </div>
    </div>
  </section>

  <main class="tiles">
    <!-- Akses -->
    <a class="tile-card square" href="akses.html">
      <img class="icon" src="assets/icons/access.svg" alt="Akses" />
      <h3 class="title">Akses Perkhidmatan Pergigian</h3>
      <p class="subtitle">Status akses perkhidmatan mengikut daerah.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Sekolah -->
    <a class="tile-card square" href="sekolah.html">
      <img class="icon" src="assets/icons/sekolah.svg" alt="Sekolah" />
      <h3 class="title">Kesihatan Pergigian Sekolah</h3>
      <p class="subtitle">Pra sekolah, sekolah rendah dan menengah.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- KPI -->
    <a class="tile-card square" href="kpi.html">
      <img class="icon" src="assets/icons/kpi.svg" alt="KPI" />
      <h3 class="title">Indikator Prestasi Utama (KPI)</h3>
      <p class="subtitle">Sasaran utama kesihatan pergigian.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Tenaga Kerja -->
    <a class="tile-card square" href="workforce.html">
      <img class="icon" src="assets/icons/workforce.svg" alt="Tenaga Kerja" />
      <h3 class="title">Tenaga Kerja Pergigian</h3>
      <p class="subtitle">Latihan & purata hasil kerja.</p>
      <span class="cta">info lanjut</span>
    </a>

    <!-- Program Pencegahan -->
    <a class="tile-card square" href="prevention.html">
      <img class="icon" src="assets/icons/prevention.svg" alt="Pencegahan" />
      <h3 class="title">Program Pencegahan Pergigian</h3>
      <p class="subtitle">MMI, klinikal pencegahan karies & outreach.</p>
      <span class="cta">info lanjut</span>
    </a>
    
  <h2 class="row-heading" id="summaryHeading">
      Ringkasan Pencapaian Kesihatan Pergigian
  </h2>

<!-- =========================================================
===== START DATAVIZ TILE SECTION (labels inside frame) =======
   • Taller graph (tile height 420px)
   • Bars and labels live INSIDE .dv-frame (cannot spill out)
   • Dedicated bottom label strip; long text wraps to 2–3 lines
   • All classes prefixed .dv-* and self-contained
========================================================== -->

<style>
  .dv-span-3{ grid-column: span 3; }
  .dv-span-2{ grid-column: span 2; }

  .tile-card.dv{
    position:relative;
    height:360px;              /* taller */
    padding:20px;
    overflow:visible;
    /* master knobs */
    --chip-w: 156px;        /* chip width */
    --chip-gap: 12px;        /* gap between chip and frame edge */
    --chip-gap: 8px;
    /* inner frame insets from tile edge (top | right | bottom | left) */
    --frame-top: 60px;
    --frame-right: 168px;
    --frame-bottom: 60px;
    --frame-left: 168px;
    /* layout inside frame */
    --side-pad: 28px;       /* horizontal padding inside frame */
    --label-strip:72px;   /* reserved space for vertical labels */
    --bar-w: 22px;          /* total bar width (unchanged) */
    --track-radius: 12px;   /* outer corner radius */
    --chip-overlap: 16px; /* how far the chip intrudes into the frame */
    --track-border: 4px;    /* ↑ make this bigger for a wider white border */
    --chip-h: 108px;      /* default; JS will overwrite with tallest chip */
    --badge-pad: 24px;    /* room so text doesn't sit under badge */
    --badge-size: 36px;   /* badge circle; keep if you like the current size */
    --dv-dur: 1400ms;     /* change if you want faster/slower */
  }

  /* inner frame (container for bars + labels) */
  .dv-frame{
    position:absolute;
    inset: var(--frame-top) var(--frame-right) var(--frame-bottom) var(--frame-left);
    border-radius:24px;
    background: var(--neu-surface);
    border: 0;
    overflow:hidden;                                    /* keep bars/labels inside */
  
    /* raised (extruded) look — light top-left, dark bottom-right */
    box-shadow:
      16px 16px 32px var(--neu-dark),
      -16px -16px 32px var(--neu-light),
      inset 0 1px 0 rgba(255,255,255,.65),              /* subtle inner polish */
      inset 0 -2px 8px rgba(2,6,23,.04);
  }
  
  /* OPTIONAL: if you prefer a “pressed” well, add class `neu-pressed` to .dv-frame */
  .dv-frame.neu-pressed{
    box-shadow:
      inset 14px 14px 28px var(--neu-dark),
      inset -14px -14px 28px var(--neu-light);
  }

  /* OPTIONAL: a little hover lift (if desired) */
.tile-card.dv:hover .dv-frame{
  box-shadow:
    20px 20px 40px var(--neu-dark),
    -20px -20px 40px var(--neu-light),
    inset 0 1px 0 rgba(255,255,255,.65),
    inset 0 -2px 8px rgba(2,6,23,.04);
}
  /* bars area — leaves a bottom strip for labels */
  .dv-bars{
    position:absolute;
    left:  var(--side-pad);
    right: var(--side-pad);
    top:   40px;                    /* headroom for knobs inside frame */
    bottom: calc(var(--label-strip) + 8px);
    display:grid; grid-template-columns:repeat(4,1fr);
    align-items:end; gap:22px; pointer-events:none; z-index:1;
  }

  .dv-bar{ grid-column: span 1; height:100%; display:flex; align-items:flex-end; justify-content:center; position:relative; }
  .dv-track{
    width: var(--bar-w);
    height: 100%;
    position: relative;
    box-sizing: border-box;                 /* keeps total width == --bar-w */
    border: var(--track-border) solid #fff; /* thicker white border */
    border-radius: var(--track-radius);
    background: #eef2f7;                    /* light gray above stopper */
    box-shadow: 0 8px 18px rgba(2,6,23,.06);
    overflow: hidden;                        /* clip inner fill to rounded edge */
  }
  /* track keeps the full bar white border + clipping */
  .dv-track{ --p:0%; }  /* percent height of the coloured fill */
  
  /* slimmer but wider stopper */
  .dv-track::after{
    content:"";
    position:absolute; left:50%; transform:translateX(-50%);
    top: calc(100% - var(--p) - 7px);   /* center a 14px stopper */
    width: calc(100% + 6px);            /* wider than the whole bar */
    height:14px;                        /* thinner */
    border-radius:9px; background:#fff;
    box-shadow:0 1px 2px rgba(2,6,23,.12), inset 0 0 0 1px #e8edf4;
    z-index:3;
  }
  
  /* slim grey line inside the stopper */
  .dv-track::before{
    content:"";
    position:absolute; left:50%; transform:translateX(-50%);
    top: calc(100% - var(--p) - 1px);
    width:22px; height:2px; border-radius:2px; background:#9aa6b2;
    z-index:4;
  }

  /* full-width coloured fill inside the white-bordered track */
  .dv-fill{
    position:absolute;
    bottom:0;
    left:0;                 /* <-- was var(--track-border) */
    right:0;                /* <-- was var(--track-border) */
    height:0%;              /* animated by JS */
    transition: height var(--dv-dur) cubic-bezier(.22,.61,.36,1);
    will-change: height;
    background: var(--dv-color, #0ea5a0);
    border:none;
    /* square top so it doesn’t pinch in when short */
    border-radius: 0 0 calc(var(--track-radius) - var(--track-border))
                       calc(var(--track-radius) - var(--track-border));
    box-shadow:none;
  }


    /* stopper: slightly wider and a touch taller */
    .dv-fill::after{
      content:'';
      position:absolute;
      top:-12px;
      left:50%; transform:translateX(-50%);
      width: calc(100% + 10px);   /* overhangs the bar a little */
      height: 18px;               /* thicker than before */
      border-radius: 12px;
      background:#fff;
      box-shadow: 0 1px 2px rgba(2,6,23,.12), inset 0 0 0 1px #e8edf4;
      z-index:2;
    }
    
    /* grey line inside the stopper (kept centered and wider too) */
    .dv-fill::before{
      content:'';
      position:absolute;
      top:-4px;
      left:50%; transform:translateX(-50%);
      width: 24px; height:3px;
      border-radius:2px;
      background:#9aa6b2;
      z-index:3;
    }

    @media (prefers-reduced-motion: reduce){
  .dv-fill{ transition:none; }
    }

  /* map bars to columns */
  .dv-bar.b1{ grid-column:1; }
  .dv-bar.b2{ grid-column:2; }
  .dv-bar.b3{ grid-column:3; }
  .dv-bar.b4{ grid-column:4; }


/* bottom label strip INSIDE the frame */
.dv-labels{
  position:absolute;
  left:  var(--side-pad);
  right: var(--side-pad);
  bottom: 0;
  height: var(--label-strip);
  display:grid;
  grid-template-columns: repeat(4, 1fr);  /* wider cells so text fits */
  align-items:flex-start;
  justify-items:center;
  padding-top:6px;
  align-items:flex-start; justify-items:center; padding-top:4px;
  pointer-events:none; z-index:2;
}
/* one label per quarter; centers line up with bar centers */
.dv-labels .c1{ grid-column:1; }
.dv-labels .c2{ grid-column:2; }
.dv-labels .c3{ grid-column:3; }
.dv-labels .c4{ grid-column:4; }

/* horizontal labels: smaller type, wrap to 2 lines, no ellipsis */
.dv-lbl{
  transform:none;
  width:95%; 
  max-width:150px;                /* stay within the cell */
  text-align:center;
  font-size:10.5px;          /* smaller so two lines fit */
  line-height:1.05;
  font-weight:800;
  text-wrap:balance;
  white-space:normal;
  word-break:break-word;
  overflow-wrap:anywhere;
  hyphens:auto;
  min-height: calc(2 * 1.05em);  /* reserve space for two lines */
  /* no line-clamp => no "..." */
}

.dv-lbl[data-wide="1"]{ max-width:136px; }  /* optional for very long labels */

  /* anchor layer matches inner frame; chips sit OUTSIDE it */
  .dv-anchors{
    position:absolute;
    inset: var(--frame-top) var(--frame-right) var(--frame-bottom) var(--frame-left);
    --row1: 25%;
    --row2: 75%;
    z-index: 5; 
  }

  /* chips (outside frame, inside tile) */
  .dv-chip{
    position:absolute; width:var(--chip-w); padding:10px 12px; border-radius:14px;
    border:1px solid #e7ecf3; background:#fff; box-shadow:0 12px 24px rgba(2,6,23,.14);
    display:flex; align-items:center; gap:8px; z-index:2; text-decoration:none; color:inherit;
    height: var(--chip-h);
    overflow: visible;  /* you already had this below; it's fine here too */

  }
  .dv-chip.left  { right: calc(100% - var(--chip-overlap)); }
  .dv-chip.right { left:  calc(100% - var(--chip-overlap)); }
  .dv-chip.top   { top:   var(--row1); transform: translateY(-50%); }
  .dv-chip.bottom{ top:   var(--row2); transform: translateY(-50%); }

  .dv-badge{
    width: var(--badge-size);
    height: var(--badge-size);
    border-radius: calc(var(--badge-size) / 3);
    display:grid; place-items:center;
    background: var(--badge,#94a3b8);
    box-shadow:0 10px 22px rgba(2,6,23,.18), inset 0 1px 0 rgba(255,255,255,.9);
  }


  /* Make the icon badge poke out half beyond the chip edge toward the center */
  .dv-chip { overflow: visible; }  /* allow badge to extend outside */
  
  .dv-chip.right .dv-badge,
  .dv-chip.left  .dv-badge{
    position: absolute;        /* detach from flex flow */
    top: 50%;
    transform: translateY(-50%);
    margin: 0;                 /* neutralize earlier margins */
  }

  .dv-chip.right .dv-badge { left:  calc(var(--badge-size) / -2); }
  .dv-chip.left  .dv-badge { right: calc(var(--badge-size) / -2); }


  .dv-ico{
    /* icon sits inside with safe padding; increase/decrease the 12px gap if needed */
    width:  calc(var(--badge-size) - 12px);
    height: calc(var(--badge-size) - 12px);
    display:block;
    max-width:100%; max-height:100%;
    filter:brightness(0) invert(1) contrast(1.2);
  }

  .dv-chip.right .dv-badge{ order:0; margin-right:6px; }
  .dv-chip.left  .dv-badge{ order:2; margin-left:6px; }

  .dv-valbox{
  display:flex; flex-direction:column;
  min-width:0;
  flex:1 1 auto;     /* fill chip width */
  }
  .dv-chip.right .dv-valbox{ padding-left: var(--badge-pad); }
  .dv-chip.left  .dv-valbox{ padding-right: var(--badge-pad); }

  .dv-val{ font-weight:900; font-size:16px; line-height:1.1; margin-bottom:2px; white-space:nowrap; }
  .dv-sub{
    font-size:11px; line-height:1.25; color:#475569;
    display:-webkit-box; -webkit-box-orient:vertical;
    -webkit-line-clamp:6;   /* was 3 */
    overflow:hidden;
  }


  @media (max-width:1200px){
    .tile-card.dv{ --frame-right: 160px; --frame-left: 160px; --chip-w: 150px; }
  }
  @media (max-width:1024px){
    .tile-card.dv{ --frame-right: 150px; --frame-left: 150px; --chip-w: 146px; }
  }
</style>

<!-- LEFT: Data Visualization tile -->
<div class="tile-card dv dv-span-3" id="dv1">
  <h3 class="dv-title">Akses Kesihatan Pergigian, Pencapaian Toddler, Ibu Mengandung &amp; Warga Emas</h3>
  <div class="dv-frame neu-pressed">
    <!-- bars INSIDE the frame -->
    <div class="dv-bars" id="dvBars">
      <div class="dv-bar b1" style="--dv-color:#F0668F">
        <div class="dv-track"><div class="dv-fill"></div></div>
      </div>
      <div class="dv-bar b2" style="--dv-color:#FBAC45">
        <div class="dv-track"><div class="dv-fill"></div></div>
      </div>
      <div class="dv-bar b3" style="--dv-color:#42BC9E">
        <div class="dv-track"><div class="dv-fill"></div></div>
      </div>
      <div class="dv-bar b4" style="--dv-color:#59AFE2">
        <div class="dv-track"><div class="dv-fill"></div></div>
      </div>
    </div>

    <!-- labels INSIDE the frame in a dedicated strip -->
    <div class="dv-labels" id="dvLabels">
      <div class="c1"><span class="dv-lbl">Akses</span></div>
      <div class="c2"><span class="dv-lbl">Toddler TPR</span></div>
      <div class="c3"><span class="dv-lbl" data-wide="1">Ibu Mengandung</span></div>
      <div class="c4"><span class="dv-lbl" data-wide="1">Warga Emas ≥20 gigi</span></div>
    </div>
  </div>

  <!-- chips positioned relative to the frame and placed OUTSIDE it -->
  <div class="dv-anchors">
    <a class="dv-chip left top" href="akses.html?tile=1" style="--badge:#F0668F" title="Akses Perkhidmatan Pergigian">
      <div class="dv-valbox">
        <div class="dv-val" data-dv-val="1">--%</div>
        <div class="dv-sub">Penduduk Kedah telah mendapat perkhidmatan pergigian</div>
      </div>
      <span class="dv-badge"><img class="dv-ico" src="assets/icons/aksesPendudukKedah.svg" alt="Akses" /></span>
    </a>

    <a class="dv-chip right top" href="akses.html?tile=5&filter=maintaining_orally_fit" style="--badge:#FBAC45" title="Toddler TPR, sasaran: 75%">
      <span class="dv-badge"><img class="dv-ico" src="assets/icons/babyToddler.svg" alt="Toddler" /></span>
      <div class="dv-valbox">
        <div class="dv-val" data-dv-val="2">--%</div>
        <div class="dv-sub">Toddler tidak perlu rawatan</div>
      </div>
    </a>

    <a class="dv-chip left bottom" href="akses.html?tile=9&filter=wargaemas_gigi20" style="--badge:#59AFE2" title="% Warga Emas ≥20 gigi, sasaran: 30%">
      <div class="dv-valbox">
        <div class="dv-val" data-dv-val="4">--%</div>
        <div class="dv-sub">Warga emas mempunyai  lebih 20 batang gigi</div>
      </div>
      <span class="dv-badge"><img class="dv-ico" src="assets/icons/wargaEmas.svg" alt="Warga Emas" /></span>
    </a>

    <a class="dv-chip right bottom" href="akses.html?tile=6&filter=ibu_orally_fit" style="--badge:#42BC9E" title="% Ibu Mengandung Orally Fit, sasaran: 25%">
      <span class="dv-badge"><img class="dv-ico" src="assets/icons/pregnantWoman.svg" alt="Ibu Mengandung" /></span>
      <div class="dv-valbox">
        <div class="dv-val" data-dv-val="3">--%</div>
        <div class="dv-sub">Ibu mengandung mencapai orally fit</div>
      </div>
    </a>
  </div>
</div>

<!-- tile 2 2nd row: Gauge tile (inner frame removed, neumorphic kept) -->
<section class="tile-card dv-span-2" id="gaugeAges" style="height:360px">
  <h3 class="dv-title">Bebas Karies Mengikut Umur</h3>

  <style>
    /* ---- local styles for this gauge only ---- */
    #gaugeAges .g-wrap{ position:absolute; inset:58px 20px 18px 20px; }
    /* keep neumorphism using paired drop-shadows on the gauge disc */
    #gaugeAges svg{
      position:absolute; inset:0; width:100%; height:100%; display:block;
      filter: drop-shadow(16px 16px 32px var(--neu-dark))
              drop-shadow(-16px -16px 32px var(--neu-light));
    }
    /* legend: no frame; centered row below the gauge */
    /* legend: no frame; centered row below the gauge */
    #gaugeAges .legend{
      position:absolute;
      left:50%;
      bottom:-6px;                 /* move slightly outside the gauge area */
      transform:translateX(-50%);
      display:flex; align-items:center; gap:16px;
      font-size:12px; color:#475569;
      background:none; padding:0; border:none; box-shadow:none; border-radius:0;
    }
    #gaugeAges .legend .sq{ width:10px; height:10px; border-radius:3px; display:inline-block; }

    #gaugeAges .sq{ width:10px; height:10px; border-radius:3px; display:inline-block; }
    /* value labels placed just outside the ring */
    #gaugeAges .val{
      position:absolute; transform:translate(-50%,-50%);
      font-weight:800; font-size:14px; background:#fff;
      padding:2px 6px; border-radius:8px; box-shadow:var(--shadow-1);
    }

    /* --- force the legend to be one line --- */
    #gaugeAges .legend{
      flex-wrap: nowrap;   /* keep all items on a single row */
      gap: 24px;           /* spacing between items */
    }

    #gaugeAges .legend span{
      display: inline-flex;      /* icon + text sit in one line */
      align-items: center;
      gap: 8px;
      white-space: nowrap;       /* prevent "6 Tahun" from breaking */
      line-height: 1;
    }

    /* ensure the square keeps its size and doesn't cause wrapping */
    #gaugeAges .legend .sq{ flex:0 0 10px; }
    
    /* outer serrated tick ring */
    #gaugeAges .tick { stroke:#e2e8f0; opacity:.95; }
    #gaugeAges .tick.minor { stroke-width:1.4; }
    #gaugeAges .tick.major { stroke-width:2.4; }


  </style>

  <div class="g-wrap">
    <!-- SVG gauge (0–100 mapped to -110° .. +110°), no inner frame -->
    <svg viewBox="-120 -120 240 240" aria-hidden="true">
      <!-- raised white disc to catch the neu drop-shadows -->
      <circle cx="0" cy="0" r="100" fill="#ffffff"/>
      <!-- base ring -->
      <circle cx="0" cy="0" r="88" fill="none" stroke="#e5e7eb" stroke-width="18"/>
      <!-- subtle inner face -->
      <circle cx="0" cy="0" r="62" fill="#f8fafc"/>
      <!-- outer tick ring -->
      <g id="tickGroup" stroke-linecap="round"></g>

      <!-- coloured ring segments + needles populated by JS -->
      <g id="arcGroup"></g>
      <g id="needleGroup" stroke-linecap="round"></g>

      <!-- center cap -->
      <circle cx="0" cy="0" r="14" fill="#fff" stroke="#e5e7eb"/>
    </svg>

    <!-- numeric value labels (positions set by JS) -->
    <div class="val" id="lbl6"  style="color:#FBAC45">--%</div>
    <div class="val" id="lbl12" style="color:#44BD9E">--%</div>
    <div class="val" id="lbl16" style="color:#5AAEE1">--%</div>

    <!-- legend -->
    <div class="legend">
      <span><i class="sq" style="background:#FBAC45"></i> 6 Tahun</span>
      <span><i class="sq" style="background:#44BD9E"></i> 12 Tahun</span>
      <span><i class="sq" style="background:#5AAEE1"></i> 16 Tahun</span>
    </div>
  </div>

  <script>
    // ---- self-contained helpers ----
    const GAUGE = {start:-110, end:110, r:88, needle:64, arcSpan:14};
    const COLORS = {v6:'#FBAC45', v12:'#44BD9E', v16:'#5AAEE1'};
    const SRC = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=898117748&single=true&output=csv';
  
    function colToIndex(col){let n=0;for(let i=0;i<col.length;i++)n=n*26+(col.charCodeAt(i)-64);return n-1;}
    function parseCell(ref){const m=ref.match(/^([A-Z]+)(\d+)$/i);return {c:colToIndex(m[1].toUpperCase()), r:+m[2]-1};}
    function parseCSV(txt){const rows=[],row=[];let cur='',q=false;for(let i=0;i<txt.length;i++){const ch=txt[i],nx=txt[i+1];if(ch=='"'){if(q&&nx=='"'){cur+='"';i++;}else q=!q;}else if(ch==','&&!q){row.push(cur);cur='';}else if((ch=='\n'||ch=='\r')&&!q){row.push(cur);rows.push(row.splice(0));cur='';if(ch=='\r'&&nx=='\n')i++;}else cur+=ch;}if(cur!==''||row.length){row.push(cur);rows.push(row);}return rows;}
    async function getCell(url, cell){const t=await (await fetch(url,{cache:'no-store'})).text();const a=parseCSV(t), {r,c}=parseCell(cell);let raw=(a[r]&&a[r][c])||'';raw=(''+raw).replace('%','').trim();const v=parseFloat(raw);return isNaN(v)?0:v;}
    const pct = v => (Math.round(v*10)/10).toFixed(1).replace(/\.0$/,'') + '%';
    function degToXY(deg, r){const rad=(deg-90)*Math.PI/180;return {x:Math.cos(rad)*r, y:Math.sin(rad)*r};}
    function smallArcPath(r, a1, a2){const p1=degToXY(a1,r), p2=degToXY(a2,r), large=Math.abs(a2-a1)>180?1:0;return `M ${p1.x} ${p1.y} A ${r} ${r} 0 ${large} 1 ${p2.x} ${p2.y}`;}
    function map(v){return GAUGE.start + (Math.max(0,Math.min(100,v))/100) * (GAUGE.end-GAUGE.start);}
    function placeLabel(el, deg, rOut){
      const vb=240, half=vb/2, pt=degToXY(deg,rOut);
      el.style.left = (50 + (pt.x/half)*50) + '%';
      el.style.top  = (50 + (pt.y/half)*50) + '%';
    }
  
    // outer serrated tick ring
    function buildTicks(){
      const T1 = 108, T2_MINOR = 116, T2_MAJOR = 119, N = 72;
      const g = document.getElementById('tickGroup');
      for (let i = 0; i < N; i++){
        const deg = (360 / N) * i;
        const p1 = degToXY(deg, T1);
        const isMajor = (i % 6 === 0); // every 30°
        const p2 = degToXY(deg, isMajor ? T2_MAJOR : T2_MINOR);
        const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
        ln.setAttribute('x1', p1.x); ln.setAttribute('y1', p1.y);
        ln.setAttribute('x2', p2.x); ln.setAttribute('y2', p2.y);
        ln.setAttribute('class', `tick ${isMajor ? 'major' : 'minor'}`);
        g.appendChild(ln);
      }
    }
  
    // tapered needle path (narrow tip)
    function taperedNeedlePath(angleDeg, len, baseW, tipW){
      const rad = (angleDeg-90) * Math.PI/180;
      const ux = Math.cos(rad), uy = Math.sin(rad);
      const px = -uy, py = ux;             // perpendicular
  
      const rBase = 12;                    // start inside center cap (hidden)
      const base1 = { x: ux*rBase + px*baseW, y: uy*rBase + py*baseW };
      const base2 = { x: ux*rBase - px*baseW, y: uy*rBase - py*baseW };
      const tip   = degToXY(angleDeg, len);
      const tip1  = { x: tip.x + px*tipW, y: tip.y + py*tipW };
      const tip2  = { x: tip.x - px*tipW, y: tip.y - py*tipW };
  
      return `M ${base1.x} ${base1.y} L ${tip1.x} ${tip1.y} L ${tip2.x} ${tip2.y} L ${base2.x} ${base2.y} Z`;
    }
  
    async function drawGauge(){
      buildTicks();
  
      const v6  = await getCell(SRC,'O9');
      const v12 = await getCell(SRC,'O12');
      const v16 = await getCell(SRC,'O15');
  
      const svgArcs = document.getElementById('arcGroup');
      const svgNeedles = document.getElementById('needleGroup');
  
      const data = [
        {val:v6,  color:COLORS.v6,  id:'lbl6'},
        {val:v12, color:COLORS.v12, id:'lbl12'},
        {val:v16, color:COLORS.v16, id:'lbl16'}
      ];
  
      // static coloured arc segments (unchanged)
      data.forEach(d=>{
        const ang = map(d.val);
        const a1 = ang-GAUGE.arcSpan/2, a2 = ang+GAUGE.arcSpan/2;
        const arc = document.createElementNS('http://www.w3.org/2000/svg','path');
        arc.setAttribute('d', smallArcPath(GAUGE.r, a1, a2));
        arc.setAttribute('fill','none');
        arc.setAttribute('stroke', d.color);
        arc.setAttribute('stroke-width','18');
        svgArcs.appendChild(arc);
      });
  
      // create tapered needles (narrow tip), then animate
      const BASE_W = 3.2;      // <-- thicker near hub
      const TIP_W  = 1.2;      // <-- narrower tip
      const LEN    = GAUGE.needle;
      const lblR   = GAUGE.r + 20;
  
      const needles = data.map(d=>{
        const p = document.createElementNS('http://www.w3.org/2000/svg','path');
        p.setAttribute('fill', d.color);
        p.setAttribute('d', taperedNeedlePath(map(0), LEN, BASE_W, TIP_W)); // start at 0%
        svgNeedles.appendChild(p);
        return {path:p, color:d.color, targetVal:d.val, label:document.getElementById(d.id)};
      });
  
      // animate all needles + labels together
      const DURATION = 1400; // ms
      const start = performance.now();
  
      function step(now){
        const t = Math.min(1, (now - start) / DURATION);
        needles.forEach(n=>{
          const curVal = n.targetVal * t;            // 0 → target
          const ang    = map(curVal);
          n.path.setAttribute('d', taperedNeedlePath(ang, LEN, BASE_W, TIP_W));
          n.label.textContent = pct(curVal);
          placeLabel(n.label, ang, lblR);
        });
        if (t < 1) requestAnimationFrame(step);
      }
  
      // init labels at 0% and position them; then start
      needles.forEach(n=>{
        n.label.textContent = pct(0);
        placeLabel(n.label, map(0), lblR);
      });
      requestAnimationFrame(step);
    }
  
    if (document.readyState !== 'loading') drawGauge();
    else document.addEventListener('DOMContentLoaded', drawGauge);
  </script>

</section>

<!-- ===== END DATAVIZ 2 TILE SECTION ===== -->


<!-- ===== END DATAVIZ TILE SECTION ===== -->



  </main>

  <footer class="wrap">Analisa Kesihatan Pergigian Negeri Kedah • Paparan optimum disyorkan melalui pelayar web desktop</footer>

  <script>
    // ---------- SEARCH MANIFEST ----------
    function link(page, tile, key){
      const u = new URL(page, location.href);
      if (tile)   u.searchParams.set('tile', tile);
      if (key)    u.searchParams.set('filter', key);
      return u.pathname.replace(location.pathname.split('/').pop(),'') + u.search;
    }

    const AKSES = [
      { type:'tile', page:'akses.html', tile:'', key:'', label:'Akses Perkhidmatan Pergigian', sub:'Halaman' },
    ];

    const SEKOLAH = [
      { type:'tile', page:'sekolah.html', tile:'ps1-tile', key:'', label:'Pra Sekolah, Tadika & Tadika Swasta', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m1', label:'Bilangan institusi', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m2', label:'Jumlah enrolmen', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m3', label:'% Liputan Tadika', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m4', label:'% Liputan Murid', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m5', label:'% TPR', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m6', label:'% MBK', sub:'Pra Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'ps1', key:'m7', label:'% Kes selesai', sub:'Pra Sekolah' },

      { type:'tile', page:'sekolah.html', tile:'sr2-tile', key:'', label:'Sekolah Rendah', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_bil', label:'Bilangan sekolah', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_enrol', label:'Jumlah enrolmen', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_dilawati', label:'Peratus SR dilawati', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_liputan', label:'Peratus murid SR mendapat liputan', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_orallyfit', label:'Peratus murid SR mencapai status orally fit', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_kesselesai', label:'Peratus murid SR kes selesai', sub:'Sekolah Rendah' },
      { type:'filter', page:'sekolah.html', tile:'s2', key:'sr_tpr', label:'Peratus murid SR TPR', sub:'Sekolah Rendah' },

      { type:'tile', page:'sekolah.html', tile:'sm3-tile', key:'', label:'Sekolah Menengah', sub:'Halaman Sekolah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_bil', label:'Bilangan sekolah (SM)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_enrol', label:'Jumlah enrolmen (SM)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_dilawati', label:'Peratus SM dilawati', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_liputan', label:'Peratus murid SM mendapat liputan', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_orallyfit', label:'Peratus murid SM mencapai status orally fit', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_kesselesai', label:'Peratus liputan murid SM mencapai status orally fit (kes selesai)', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_tpr', label:'Peratus murid SM TPR', sub:'Sekolah Menengah' },
      { type:'filter', page:'sekolah.html', tile:'s3', key:'sm_kehilangan', label:'Kehilangan gigi kekal/100 murid 16 tahun', sub:'Sekolah Menengah' },
    ];

    const KPI = [
      { type:'tile', page:'kpi.html', tile:'k1-tile', key:'', label:'KEY ORAL HEALTH GOALS', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf6', label:'6-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf12', label:'12-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'cf16', label:'16-year-olds Caries free', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'hp12', label:'12-year-olds with healthy periodontium', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'hp16', label:'16-year-olds with healthy periodontium', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'ft20', label:'60-year-old and above with minimum 20 functional teeth', sub:'Key Goals' },
      { type:'filter', page:'kpi.html', tile:'k1', key:'oc_stage1', label:'Oral cancers detected at stage 1', sub:'Key Goals' },

      { type:'tile', page:'kpi.html', tile:'k2-tile', key:'', label:'NIA', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_primary_tpr',   label:'Percentage of Primary School Children Maintaining Orally Fit Status', sub:'NIA' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_secondary_tpr', label:'Percentage of Secondary School Children Maintaining Orally Fit Status', sub:'NIA' },
      { type:'filter', page:'kpi.html', tile:'k2', key:'nia_under5_cariesfree', label:'Percentage of Children below 5 years examined with Caries Free Mouth', sub:'NIA' },

      { type:'tile', page:'kpi.html', tile:'k3-tile', key:'', label:'SUPPORTING ORAL HEALTH GOALS', sub:'Halaman KPI' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dfx6',   label:'6-year-olds - mean dfx', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dmfx12', label:'12-year-olds - mean DMFX', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'dmfx16', label:'16-year-olds - mean DMFX', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'m16',    label:'16-year-olds - mean M', sub:'Supporting Goals' },
      { type:'filter', page:'kpi.html', tile:'k3', key:'m0_16',  label:'16-year-olds with M = 0', sub:'Supporting Goals' },
    ];

    const WORKFORCE = [
      { type:'tile', page:'workforce.html', tile:'tkp1-tile', key:'', label:'Latihan Dalam Perkhidmatan', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c1', label:'% of courses/training conduct using LDP allocation', sub:'LDP' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c2', label:'% of LDP allocation spend', sub:'LDP' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c3', label:'% of staffs with 3 days in-service training', sub:'Latihan' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c4', label:'% of staffs with 7 days in-service training', sub:'Latihan' },
      { type:'filter', page:'workforce.html', tile:'t1', key:'c5', label:'% of MyCPD users with 0 MyCPD point', sub:'MyCPD' },

      { type:'tile', page:'workforce.html', tile:'tkp2-tile', key:'', label:'PURATA HASIL KERJA Pegawai Pergigian', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pp_on_duty',    label:'Bil. PP yang bertugas', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pasien_total',  label:'Pesakit Baru + Ulangan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'pasien_rate',   label:'Pesakit Baru + Ulangan (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'tampalan_total', label:'Tampalan Gigi Kekal + Desidus (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'tampalan_rate',  label:'Tampalan Gigi Kekal + Desidus (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'cabut_total',   label:'Cabutan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'cabut_rate',    label:'Cabutan (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'skaler_total',  label:'Penskaleran (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'skaler_rate',   label:'Penskaleran (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'dentur_total',  label:'Dentur (penuh+separa) (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'dentur_rate',   label:'Dentur (penuh+separa) (Purata/PP)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'fisur_total',   label:'Fisur Sealan (Jumlah)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'fisur_rate',    label:'Fisur Sealan (Purata)', sub:'Pegawai' },
      { type:'filter', page:'workforce.html', tile:'t2', key:'varnis_total',  label:'Florida varnis (Jumlah)', sub:'Pegawai' },

      { type:'tile', page:'workforce.html', tile:'tkp3-tile', key:'', label:'PURATA HASIL KERJA Juruterapi Pergigian', sub:'Tenaga Kerja' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_on_duty',      label:'Bil. JP yang bertugas', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_pasien_total', label:'Pesakit Baru + Ulangan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_pasien_rate',  label:'Pesakit Baru + Ulangan (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_tampalan_total', label:'Tampalan Gigi Kekal + Desidus (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_tampalan_rate',  label:'Tampalan Gigi Kekal + Desidus (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_cabut_total',   label:'Cabutan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_cabut_rate',    label:'Cabutan (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_skal_total',    label:'Penskaleran (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_skal_rate',     label:'Penskaleran (Purata/JP)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_fisur_total',   label:'Fisur Sealan (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_fisur_rate',    label:'Fisur Sealan (Purata)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_varnis_total',  label:'Florida varnis (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_varnis_rate',   label:'Florida varnis (Purata)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_kes_total',     label:'Kes selesai (Jumlah)', sub:'Juruterapi' },
      { type:'filter', page:'workforce.html', tile:'t3', key:'jp_kes_rate',      label:'Kes selesai (Purata/JP)', sub:'Juruterapi' },
    ];

    const PREVENTION = [
      { type:'tile', page:'prevention.html', tile:'p1-tile', key:'', label:'Clinical Prevention Program for Caries', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj23', label:'Cohort Jan-Jun 2023', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd23', label:'Cohort Jul-Dis 2023', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj24', label:'Cohort Jan-Jun 2024', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd24', label:'Cohort Jul-Dis 2024', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jj25', label:'Cohort Jan-Jun 2025', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'cohort_jd25', label:'Cohort Jul-Dis 2025', sub:'Clinical Prevention' },

      { type:'filter', page:'prevention.html', tile:'p1', key:'paa_mbk',                 label:'Program Anak Angkat — % anak angkat dengan status MBK', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fv_pre',                  label:'% of pre-schoolchildren rendered FV', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fv_primary',              label:'% of primary schoolchildren rendered FV', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_pre',                  label:'% of pre-schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_preschool',      label:'% of teeth rendered FS (Preschool)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_primary',              label:'% of primary schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_primary',        label:'% of teeth rendered FS (Primary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_secondary',            label:'% of secondary schoolchildren rendered FS', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'fs_teeth_secondary',      label:'% of teeth rendered FS (Secondary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_primary',             label:'% of primary schoolchildren rendered PRR', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_teeth_primary',       label:'% of teeth rendered PRR (Primary school)', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_secondary',           label:'% of secondary schoolchildren rendered PRR', sub:'Clinical Prevention' },
      { type:'filter', page:'prevention.html', tile:'p1', key:'prr_teeth_secondary',     label:'% of teeth rendered PRR (Secondary school)', sub:'Clinical Prevention' },

      { type:'tile', page:'prevention.html', tile:'p2-tile', key:'', label:'Malaysian Modified ICDAS', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_schools',     label:'primary schools screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_children',    label:'primary school children screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_E',           label:'primary schoolchildren with E', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_primary_meanD',       label:'Mean D of primary schoolchildren', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_schools',   label:'secondary schools screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_children',  label:'secondary school children screened using MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_E',         label:'secondary schoolchildren with E', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_secondary_meanD',     label:'Mean D of secondary schoolchildren', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_staff_trained',       label:'staff trained with MMI', sub:'MMI' },
      { type:'filter', page:'prevention.html', tile:'p2', key:'mmi_calibration_sessions',label:'No of calibration session conducted', sub:'MMI' },

      { type:'tile', page:'prevention.html', tile:'p3-tile', key:'', label:'Outreach', sub:'Pencegahan' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'new_patient',             label:"new patient at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'repeat_patient',          label:"repeat patient at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'attendance',              label:"patients' attendance at UTC/RTC", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'kg_angkat_screening',     label:"% Kg. Angkat visited with oral cancer screening", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2021',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2021", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2022',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2022", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2023',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2023", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2024',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2024", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'homevisit_2025',          label:"% of homevisit done to the family in Kg Angkat Pergigian 2025", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'bilangan_selesai_baharu', label:"% Bilangan selesai kes / kehadiran baharu", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'ppr_homevisit',           label:"% of homevisit done to the family in PPR", sub:'Outreach' },
      { type:'filter', page:'prevention.html', tile:'p3', key:'ppr_kes_selesai',         label:"% Kes Selesai in PPR", sub:'Outreach' },
    ];

    const SEARCH_INDEX = [
      ...AKSES, ...SEKOLAH.filter(x=>x.type==='tile'), ...KPI.filter(x=>x.type==='tile'),
      ...WORKFORCE.filter(x=>x.type==='tile'), ...PREVENTION.filter(x=>x.type==='tile'),
      ...SEKOLAH.filter(x=>x.type==='filter'), ...KPI.filter(x=>x.type==='filter'),
      ...WORKFORCE.filter(x=>x.type==='filter'), ...PREVENTION.filter(x=>x.type==='filter'),
    ].map(item => ({ ...item, url: link(item.page, item.tile, item.key) }));

    // ---------- AUTOCOMPLETE ----------
    const q = document.getElementById('globalSearch');
    const box = document.getElementById('suggestBox');
    const goBtn = document.getElementById('goBtn');

    function normalize(s){ return (s||'').toLowerCase().normalize('NFKD').replace(/[\u0300-\u036f]/g,''); }

    function search(term){
      const t = normalize(term).trim();
      if(!t) return [];
      const parts = t.split(/\s+/).filter(Boolean);
      return SEARCH_INDEX.filter(item=>{
        const hay = normalize(item.label + ' ' + (item.sub||''));
        return parts.every(p => hay.includes(p));
      }).slice(0, 50);
    }

    function render(list){
      if(!list.length){
        box.innerHTML = '<div class="empty">Tiada cadangan.</div>';
        box.style.display = 'block';
        return;
      }
      box.innerHTML = list.map((it,i)=>`
        <div class="opt" data-url="${it.url}">
          <span class="type">${it.type === 'filter' ? 'Saringan' : 'Graf'}</span>
          <span class="lbl">${it.label}</span>
          <span class="sub">${it.sub || ''}</span>
        </div>
      `).join('');
      box.style.display = 'block';
    }

    let current=-1, currentList=[];
    q.addEventListener('input', () => { current=-1; currentList = search(q.value); render(currentList); });
    q.addEventListener('focus', () => { if(q.value) { currentList = search(q.value); render(currentList); } });

    box.addEventListener('mousedown', (e)=>{
      const opt = e.target.closest('.opt'); if(!opt) return;
      location.href = opt.getAttribute('data-url');
    });

    q.addEventListener('keydown', (e)=>{
      if(box.style.display!=='block') return;
      const opts = [...box.querySelectorAll('.opt')];
      if(e.key==='ArrowDown'){ e.preventDefault(); current = (current+1) % opts.length; opts.forEach(o=>o.classList.remove('active')); opts[current].classList.add('active'); opts[current].scrollIntoView({block:'nearest'}); }
      else if(e.key==='ArrowUp'){ e.preventDefault(); current = (current-1+opts.length) % opts.length; opts.forEach(o=>o.classList.remove('active')); opts[current].classList.add('active'); opts[current].scrollIntoView({block:'nearest'}); }
      else if(e.key==='Enter'){ e.preventDefault(); if(current>=0){ location.href = opts[current].getAttribute('data-url'); } else if(currentList[0]) { location.href = currentList[0].url; } }
      else if(e.key==='Escape'){ box.style.display='none'; }
    });

    document.addEventListener('click', (e)=>{ if(!document.querySelector('.gs-box').contains(e.target)) box.style.display='none'; });
    goBtn.addEventListener('click', ()=>{ const list = search(q.value); if(list[0]) location.href = list[0].url; });
  </script>

  <script>
/* ===== Dataviz: fetch once, animate bars + numbers in lockstep ===== */
(function(){
  const SERIES = [
    { url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=1057141723&single=true&output=csv', cell:'N11', valSel:'[data-dv-val="1"]' }, // Akses
    { url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=1851801564&single=true&output=csv', cell:'O28', valSel:'[data-dv-val="2"]' }, // Toddler TPR
    { url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=205423549&single=true&output=csv', cell:'O19', valSel:'[data-dv-val="3"]' }, // Ibu Mengandung
    { url:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSS9NxgDwQDoJrQZJS4apFq-p5oyK3B0WAnFTlCY2WGcvsMzNBGIZjilIez1AXWvAIZgKltIxLEPTFT/pub?gid=480846724&single=true&output=csv', cell:'O39', valSel:'[data-dv-val="4"]' }  // Warga Emas ≥20 gigi
  ];

  /* --- helpers --- */
  function colToIndex(col){ let n=0; for (let i=0;i<col.length;i++) n=n*26 + (col.charCodeAt(i)-64); return n-1; }
  function parseCell(ref){ const m = ref.match(/^([A-Z]+)(\d+)$/i); return { c: colToIndex(m[1].toUpperCase()), r: +m[2]-1 }; }
  function parseCSV(txt){
    const rows=[], row=[]; let cur='', q=false;
    for (let i=0;i<txt.length;i++){
      const ch=txt[i], nx=txt[i+1];
      if (ch=='"'){ if(q && nx=='"'){ cur+='"'; i++; } else q=!q; }
      else if (ch==',' && !q){ row.push(cur); cur=''; }
      else if ((ch=='\n'||ch=='\r') && !q){ row.push(cur); rows.push(row.splice(0)); cur=''; if(ch=='\r'&&nx=='\n') i++; }
      else cur+=ch;
    }
    if (cur!=='' || row.length) { row.push(cur); rows.push(row); }
    return rows;
  }
  async function getCell(url, cell){
    const t = await (await fetch(url,{cache:'no-store'})).text();
    const a = parseCSV(t), {r,c} = parseCell(cell);
    let raw = (a[r] && a[r][c]) || '';
    raw = (''+raw).replace('%','').trim();
    const v = parseFloat(raw);
    return isNaN(v) ? 0 : v;       // treat bad cells as 0
  }
  const pct = v => (Math.round(v*10)/10).toFixed(1).replace(/\.0$/,'') + '%';

  async function load(){
    // fetch all values first
    const values = await Promise.all(SERIES.map(s => getCell(s.url, s.cell)));

    // cache DOM
    const fills  = [...document.querySelectorAll('#dvBars .dv-fill')];
    const tracks = [...document.querySelectorAll('#dvBars .dv-track')];
    const vals   = SERIES.map(s => document.querySelector(s.valSel));

    // read CSS duration so CSS (bars) and JS (numbers) end together
    const host = document.querySelector('.tile-card.dv') || document.body;
    const durStr = getComputedStyle(host).getPropertyValue('--dv-dur').trim() || '1400ms';
    const DURATION = durStr.endsWith('ms') ? parseFloat(durStr) : parseFloat(durStr)*1000;

    // set starting states
    vals.forEach(el => el && (el.textContent = '0%'));
    fills.forEach(f => f && (f.style.height = '0%'));

    // force reflow so transitions start from 0%
    void document.body.offsetWidth;

    // start both animations at the same moment
    const start = performance.now();

    // 1) bars (CSS transition handles the tween; all end together)
    values.forEach((v,i) => {
      if (fills[i]) fills[i].style.height = v + '%';
      // if you kept the extra stopper on the track and want it to follow:
      if (tracks[i]) tracks[i].style.setProperty('--p', v + '%');
    });

    // 2) numbers (JS tween to match the same duration)
    function step(now){
      const t = Math.min(1, (now - start) / DURATION);   // 0 → 1 over the same time
      for (let i=0;i<values.length;i++){
        const el = vals[i]; if (!el) continue;
        el.textContent = pct(values[i] * t);
      }
      if (t < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  if (document.readyState !== 'loading') load();
  else document.addEventListener('DOMContentLoaded', load);
})();
</script>

  <script>
    // Set --chip-h to the tallest chip so all four match perfectly
    function equalizeDVChips(){
      const host = document.getElementById('dv1');
      if (!host) return;
      const chips = host.querySelectorAll('.dv-chip');
      if (!chips.length) return;

      let maxH = 0;
      chips.forEach(ch => {
        ch.style.height = 'auto';            // measure natural height
        maxH = Math.max(maxH, ch.scrollHeight);
      });

      host.style.setProperty('--chip-h', Math.ceil(maxH) + 'px');
      chips.forEach(ch => ch.style.height = 'var(--chip-h)');
    }

    // Run on load and on resize
    window.addEventListener('load', equalizeDVChips);
    window.addEventListener('resize', () => requestAnimationFrame(equalizeDVChips));
  </script>


</body>
</html>
